function setElementNameAndModel(n,t,i){if(n.$index!=undefined){n[i.closest("form")[0].name].$removeControl(t);var r=i[0].name;r=r.replace(/\{\{\$index\}\}/g,n.$index);n[i.closest("form")[0].name][r]!=undefined&&(r+="_"+n.$index);i[0].name=r;t.$name=r;n[i.closest("form")[0].name].$addControl(t);i.on("$destroy",function(){n[i.closest("form")[0].name].$removeControl(t)})}}var translationsEN={Home:"Home",Portfolio:"Portfolio",Backtesting:"Backtesting",Greeting:"Hello ",Help:"Help",Account:"My Account",Logout:"Logout"},translationsHE={Home:"בית",Portfolio:"תיקים",Backtesting:"חישוב לאחור",Greeting:"שלום ",Help:"עזרה",Account:"החשבון שלי",Logout:"יציאה"};window.app=angular.module("takinApp",["ui.select2","ngTable","ngRoute","ngResource","ui.bootstrap","custom-utilities","cgPrompt","ngSanitize","angularjs-dropdown-multiselect","pascalprecht.translate","ismobile","pasvaz.bindonce","takinApp.common"]);window.app.config(["$routeProvider","$locationProvider","$httpProvider","$provide","$translateProvider","isMobileProvider",function(n,t,i,r,u){i.defaults.useXDomain=!0;delete i.defaults.headers.common["X-Requested-With"];i.defaults.useXDomain=!0;t.html5Mode(!0);i.interceptors.push("httpInterceptor");n.when("/",{templateUrl:function(){return"scripts/app/views/shared/index.html"},label:"דף הבית"}).when("/portfolios",{templateUrl:function(){return"scripts/app/views/portfolios/portfoliosList.html"},controller:"portfolioCtrl",label:"portfolios"}).when("/portfolios/:id",{templateUrl:function(){return"scripts/app/views/portfolios/portfolioDetails.html"},controller:"portfolioDetailsCtrl",label:"portfolios"}).when("/optimizePortfolios/:name",{templateUrl:function(){return"scripts/app/views/portfolios/optimizedPortfolio.html"},controller:"optimizedPortfolioCtrl",label:"portfolios"}).when("/BuildNewPortfolio",{templateUrl:function(){return"scripts/app/views/portfolios/customPortfolio.html"},controller:"customPortfolioCtrl",label:"portfolios"}).when("/backtesting",{templateUrl:function(){return"scripts/app/views/backtesting/backtesting.html"},controller:"backtestingCtrl",label:"portfolios"}).when("/backtesting/:id",{templateUrl:function(){return"scripts/app/views/backtesting/backtesting.html"},controller:"backtestingCtrl",label:"portfolios"}).when("/createbacktesting",{templateUrl:function(){return"scripts/app/views/backtesting/createBacktesting.html"},controller:"createBacktestingCtrl",label:"portfolios"}).when("/forgetPassword",{templateUrl:function(){return"scripts/app/views/shared/forgetPassword.min.html"},controller:"forgetPasswordCtrl"}).when("/newPassword",{templateUrl:function(){return"scripts/app/views/shared/newPassword.min.html"},controller:"newPasswordCtrl"}).when("/registration",{templateUrl:function(){return"scripts/app/views/shared/registration.min.html"},controller:"registrationCtrl"}).when("/registrationTrial",{templateUrl:function(){return"scripts/app/views/shared/registrationTrialCode.html"},controller:"registrationTrialCodeCtrl"}).when("/registrationPayment",{templateUrl:function(){return"scripts/app/views/shared/registration_billing.min.html"},controller:"registrationBillingCtrl"}).when("/changeAccount",{templateUrl:function(){return"scripts/app/views/shared/changeAccountDetails.min.html"},controller:"changeAccountDetailsCtrl"}).when("/changeBilling",{templateUrl:function(){return"scripts/app/views/shared/changeBillingDetails.min.html"},controller:"changeBillingDetailsCtrl"}).otherwise({redirectTo:"/"});u.translations("en",translationsEN);u.translations("he",translationsHE);u.preferredLanguage("en");u.fallbackLanguage("en")}]);window.utilities=angular.module("custom-utilities",[]);app.run(["$rootScope","$location","$document","$window","utilitiesSvc","tfiCommonConstants","loginSvc",function(n,t,i,r,u){function e(){var t=new Date;t-f>108e4?(f=t,n.$broadcast("idleLogoutEvent")):f=t}var f=new Date;i.find("body").on("mousemove keydown DOMMouseScroll mousewheel mousedown touchstart",e);n.$on("$routeChangeStart",function(i,r,f){try{if(r.$$route.originalPath!=undefined){if(window.scrollTo(0,0),f==undefined||r.$$route.originalPath!="/"||f.$$route.originalPath!="/portfolios"||n.$$childHead.wantToLogout||sessionStorage.getItem("user")==null)if(r.$$route.originalPath=="/portfolios/")n.$$childHead.wantToLogout=!1;else{if(n.$$childHead.isIndexPage=r.$$route.originalPath=="/",n.$$childHead.isLoginPage=r.$$route.originalPath=="/"||r.$$route.originalPath=="/forgetPassword"||r.$$route.originalPath=="/newPassword",n.$$childHead.isRegistrationPage=r.$$route.originalPath=="/registration"||r.$$route.originalPath=="/registrationTrial"||r.$$route.originalPath=="/registrationPayment",n.$$childHead.isOpen=!1,!n.$$childHead.isIndexPage){var e=r.$$route.originalPath.substring(1).split("/");n.$$childHead.screenName=screens[e[e.length-1]]}f==null&&Object.keys(sessionStorage).forEach(function(n){n!="user"&&n!="sessionid"&&sessionStorage.removeItem(n)})}else i.preventDefault(),u.showYesNoMessage("message","are you sure you want to leave?","yes","no").then(function(){n.$$childHead.wantToLogout=!0;sessionStorage.removeItem("user");sessionStorage.removeItem("userDetails");t.path("/")});r.$$route.originalPath=="/"&&f.scope.$parent.logout()}}catch(o){}});n.$on("$locationChangeSuccess",function(){r.Appcues&&r.Appcues.start()})}]);app.controller("takinMngrCtrl",["$scope","$location","$window","$translate","lookupSvc","portfolioSvc","utilitiesSvc","loginSvc","$timeout","$http","isMobile","backtestingSvc","$document",function(n,t,i,r,u,f,e,o,s,h,c,l,a){function ht(){try{var n=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");n.play()}catch(t){}}function yt(){var n=a.find(".modal-dialog").find(".close");n.trigger("click")}n.screenName="";n.rout="";n.isLoginPage;n.isRegistrationPage;n.language="en";n.userName;n.isDataReady=!1;n.isInProgress=!1;n.isMobile=c.phone;n.objName;isIndexPage=!0;var v,y,b,d,g,nt,k,p,ft,tt,it,rt,ot,w=!1,et=!1,st=function(){var i,n;h.defaults.headers.common.Authorization||(sessionStorage.getItem("sessionid")&&sessionStorage.getItem("sessionid")!="undefined"?(i=angular.fromJson(sessionStorage.getItem("sessionid")),h.defaults.headers.common.Authorization="Basic "+i):(n=t.path(),n!="/registration"&&n!="/forgetPassword"&&t.path("/")))};n.back=function(){i.history.back();i.location.hash=="#maincontent"&&i.history.back()};n.setLanguage=function(){r.use(n.language)};n.saveUser=function(t){v=t;n.userName=t.Name;sessionStorage.setItem("user",t.Username);sessionStorage.setItem("userDetails",angular.toJson(v));Appcues.identify(v.UserID,{name:v.Name,email:v.Email,created_at:Date.now()});ut()};n.getUser=function(){return v||(v=angular.fromJson(sessionStorage.getItem("userDetails"))),v};n.saveNewPortfolio=function(n){y=n;sessionStorage.setItem("newPortfolio",angular.toJson(y))};n.saveNewBacktesting=function(n){b=n;sessionStorage.setItem("newBacktesting",angular.toJson(n))};n.saveUserDetails=function(n){tt=n;sessionStorage.setItem("userDetails",angular.toJson(tt))};n.saveNewBacktestingParams=function(n){k=n;sessionStorage.setItem("newBacktestingParams",angular.toJson(k))};n.saveBacktestingParams=function(n){nt=n;sessionStorage.setItem("backtestingParams",angular.toJson(nt))};n.getBacktestingParams=function(){return nt||(nt=angular.fromJson(sessionStorage.getItem("backtestingParams"))),nt};n.getNewBacktestingParams=function(){return k||(k=angular.fromJson(sessionStorage.getItem("newBacktestingParams"))),k};n.getUserDetails=function(){return tt||(tt=angular.fromJson(sessionStorage.getItem("userDetails"))),tt};n.updateUserLicence=function(t){v.Licence=t;sessionStorage.setItem("userDetails",angular.toJson(v));n.saveAccountData(v);n.getUserStocks()};n.saveFullUser=function(n){ot=n};n.getFullUser=function(){return v=angular.fromJson(sessionStorage.getItem("userDetails"))};n.getPortfolioList=function(){return rt||(rt=angular.fromJson(sessionStorage.getItem("myPortfolioList"))),rt};n.setPortfolioList=function(n){rt=n;sessionStorage.setItem("myPortfolioList",angular.toJson(rt))};n.getNewPortfolio=function(n){return(y||(y=angular.fromJson(sessionStorage.getItem("newPortfolio"))),y&&y.PortDetails&&y.PortDetails.Name==n)?y:null};n.getNewBacktesting=function(){return b||(b=angular.fromJson(sessionStorage.getItem("newBacktesting"))),b};n.saveBenchmarkSecurities=function(n){g=n;sessionStorage.setItem("benchmarkSecurities",angular.toJson(g))};n.getBenchmarkSecurities=function(){return g||(g=angular.fromJson(sessionStorage.getItem("benchmarkSecurities"))),g};n.getUserStocks=function(){n.stockMarket=[];v=n.getFullUser();for(var t=0;t<v.Licence.Stocks.length;t++)n.stockMarket.push({id:v.Licence.Stocks[t].id,label:v.Licence.Stocks[t].Name})};n.getLookupValues=function(){return d||(d=angular.fromJson(sessionStorage.getItem("lookupData"))),d};n.clearSession=function(){Object.keys(sessionStorage).forEach(function(n){n!="lookupData"&&sessionStorage.removeItem(n)})};n.createPortfolio=function(t,i){n.isInProgress=!0;w=i;n.objName=w?"Backtesting":"Portfolio";var r=w?l.createBacktesting:f.createPortfolio;r(t).$promise.then(function(t){var i=t.Messages?t.Messages[0].Text:t.Message,r=e.showOKMessage("message",i,"OK");/you will be notified when the portfolio is ready/i.test(i)?(et=!0,r.finally(function(){et=!1})):n.isInProgress=!1}).catch(function(t){n.isInProgress=!1;e.showOKMessage("error",t[0]?t[0].Text:t.data,"OK")})};n.getNewPortfolioObj=function(){return p||(p=angular.fromJson(sessionStorage.getItem("newPortfolio"))),p};n.setBacktestingDetails=function(n){b=n;sessionStorage.setItem("newBacktesting",angular.toJson(b))};var ct=function(){u.getLookup().$promise.then(function(n){d=n;sessionStorage.setItem("lookupData",angular.toJson(d))},function(){})},ut=function(){v||n.getUser();v!=null&&($.connection.hub.transportConnectTimeout=2e4,$.connection.hub.start({jsonp:!0}).done(function(){it.server.registerClient(v.UserID)}).fail(function(){s(function(){ut()},100)}),$.connection.hub.disconnected(function(){ut()}))},lt=function(){st();ct();angular.fromJson(sessionStorage.getItem("userDetails"))&&(n.userName=angular.fromJson(sessionStorage.getItem("userDetails")).Name);it=$.connection.takin;it.client.update=function(t){w?ft=JSON.parse(t):p=JSON.parse(t);et&&(yt(),et=!1);s(function(){ht();n.isInProgress=!1;w?vt():at()},200)};it.client.disconnected=function(){ut()};it.client.sessionEnded=function(){n.isInProgress=!1;n.isDataReady=!1;t.$$path!="/"&&e.showOKMessage("message","Your session has expired, please relogin","OK");sessionStorage.removeItem("user");sessionStorage.removeItem("userDetails");t.path("/")};ut()},at=function(){p.Messages.length==0?(n.saveNewPortfolio(p),n.isDataReady=!0,e.showOKMessage("message","Your optimized portfolio is ready.","View Portfolio").then(function(){n.showNewPortfolio()})):(e.showOKMessage("message",p.Messages[0].Text),n.isDataReady=!1)},vt=function(){ft.Messages.length==0?(n.saveNewBacktesting(ft),n.isDataReady=!0,e.showOKMessage("message","Your backtesting portfolio is ready.","View Portfolio").then(function(){n.showNewPortfolio()})):(e.showOKMessage("message",ft.Messages[0].Text),n.isDataReady=!1)};n.showNewPortfolio=function(){n.isDataReady=!1;n.isInProgress=!1;w?t.path("backtesting/"+k.Name):y&&t.path("optimizePortfolios/"+y.PortDetails.Name);w=!1};lt()}]);app.controller("portfolioCtrl",["$scope","$rootScope","$location","$window","ngTableParams","portfolioSvc","utilitiesSvc","$filter","lookupSvc","backtestingSvc","$timeout",function(n,t,i,r,u,f,e,o,s,h,c){var v,l,a;n.submit=!1;n.data=[];n.dataBacktesing=[];n.newPort={Exchanges:[]};n.exchanges=[];n.customType="";n.searchParams={};l=!0;a=!0;n.getPortfolios=function(){n.tableParams.reload();n.tableParams1.reload()};n.refreshPortfolios=function(t){n.data.splice(n.data.indexOf(t),1);n.tableParams.reload();y()};n.refreshBacktesting=function(t){n.dataBacktesing.splice(n.dataBacktesing.indexOf(t),1);n.tableParams1.reload()};n.sortPortfolio=function(){l=!l;n.data=o("orderBy")(n.data,n.orderByPortField,l);n.tableParams.reload()};n.sortBacktesting=function(){a=!a;n.dataBacktesing=o("orderBy")(n.dataBacktesing,n.orderByBackField,a);n.tableParams1.reload()};var y=function(){portList=[];for(var t=0;t<n.data.length;t++)portList.push({ID:n.data[t].ID,Name:n.data[t].Name});n.$parent.setPortfolioList(portList)},p=function(){n.tableParams=new u({page:1,count:5},{total:n.data.length,counts:[],getData:function(t,i){n.searchParams.pageNumber=n.tableParams.page();n.searchParams.pageSize=n.tableParams.count();n.searchParams.sortField=n.orderByPortField;n.noPortfolios=n.data.length===0;f.getPortfolios(n.searchParams).$promise.then(function(r){c(function(){n.data=r.Portfolios;i.total(r.NumOfRecords);y();v=i.page()*i.count()<r.NumOfRecords?i.count():r.NumOfRecords-(i.page()-1)*i.count();n.noPortfolios=n.data.length===0;n.data&&t.resolve(n.data)},500)})}});n.tableParams1=new u({page:1,count:5},{total:n.dataBacktesing.length,counts:[],getData:function(t,i){var r={};r.pageNumber=n.tableParams1.page();r.pageSize=n.tableParams1.count();r.sortField=n.orderByBackField;n.noBacktesting=n.dataBacktesing.length===0;h.getbacktesingPortfolies(r).$promise.then(function(r){c(function(){n.dataBacktesing=r.Ports;i.total(r.NumOfRecords);v=i.page()*i.count()<r.NumOfRecords?i.count():r.NumOfRecords-(i.page()-1)*i.count();n.noBacktesting=n.dataBacktesing.length===0;n.dataBacktesing&&t.resolve(n.dataBacktesing)},500)})}})},w=function(){n.$parent.getUserStocks()},k=function(){},b=function(){n.$parent.selectMenu=1;p();w();n.getPortfolios();user=n.$parent.getUser();n.currency=user.Currency?user.Currency.CurrencySign:"";var t=new Date;n.currentDate=t};b()}]);app.controller("newPasswordCtrl",["$scope","$location","$window","utilitiesSvc","loginSvc",function(n,t,i,r,u){n.verifyPassword;n.onKeyPress=function(t){t.keyCode==13&&n.continue()};n.continue=function(){if(!n.params||n.params.NewPassword==null||n.params.OldPassword==null||n.verifyPassword==null||n.params.Email==null||n.params.NewPassword==""||n.params.OldPassword==""||n.verifyPassword==""||n.params.Email==""){r.showOKMessage("error","Please fill up all the fields","OK");return}if(n.params.NewPassword!=n.verifyPassword){r.showOKMessage("message","New password not equal to Verify password","OK");return}u.updatePasswrod(n.params).$promise.then(f,e)};var f=function(n){n.Messages&&n.Messages.length>0?r.showOKMessage("error",n.Messages[0].Text,"OK"):(r.showOKMessage("message","Password updated successfully.","OK",!1,!0),t.path("/"))},e=function(){},o=function(){n.params=n.$parent.getUserDetails()};o()}]);app.controller("forgetPasswordCtrl",["$scope","$location","$window","loginSvc","utilitiesSvc","prompt",function(n,t,i,r,u,f){n.password;n.params={};n.onKeyPress=function(t){t.keyCode==13&&n.continue()};n.continue=function(){if(!n.params||n.params.Email==null||n.params.Email==""){u.showOKMessage("error","Please enter a valid e-mail address","OK",!1,!0);return}r.updatePasswrod(n.params).$promise.then(e,o)};var e=function(i){i.Messages&&i.Messages.length>0?u.showOKMessage("error",i.Messages[0].Text,"OK"):(n.$parent.saveUserDetails(n.params),f({title:"message",message:"New temporary password was sent to your E-mail",closeAfter:3,buttons:[]}).then(function(){t.path("newPassword/")},function(){t.path("newPassword/")}))},o=function(){},s=function(){};s()}]);app.controller("customPortfolioCtrl",["$scope","$location","$window","$document","ngTableParams","securitiesSvc","$routeParams","utilitiesSvc","$filter","lookupSvc","$timeout","isMobile","VisibilitySpy","visibilityHelper",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function p(){n.customType==2&&(k=n.sectors.map(function(n){return n.id}),b=n.customExchanges.map(function(n){return n.id}),n.tableParams.page(1),n.tableParams.reload())}function it(n,t,i){return i?(n.sort(function(n,t){return n[i]-t[i]}),t.sort(function(n,t){return n[i]-t[i]})):(n.sort(),t.sort()),angular.equals(n,t)}function st(){return b.length>0?b.slice():n.stockMarket.map(function(n){return n.id})}function ht(){return k.length>0?k.slice():n.sectorsOptions.map(function(n){return n.iIndex})}function w(){var i=(n.customExchanges||[]).map(function(n){return n.id}),t;angular.forEach(n.filterDataSource.exchanges,function(n){n.selected=i.indexOf(n.id)>=0});t=(n.sectors||[]).map(function(n){return n.id});angular.forEach(n.filterDataSource.sectors,function(n){n.selected=t.indexOf(n.id)>=0});n.filterDataSource.riskLevel=n.searchParams.maxRiskLevel}var y,d=0,g=0,nt=[],tt=[],b=[],k=[];n.searchParams={exchangesPackagees:[],sectors:[],maxRiskLevel:0,pageNumber:1,pageSize:l.phone?20:50,searchText:"",field:"strName",direction:"asc",hideDisqualified:!0};n.showDisqualified=!1;n.riskFilter;n.data=[];n.selectedSecurities=[];n.selctesItemsNum=null;n.searchText;n.selectSecurityNum=0;n.isRiskFilter=null;n.dataLength;n.exchanges=[];n.customExchanges=[];n.sectorsOptions=[];n.sectors=[];n.newPort={Exchanges:[]};n.filterDataSource={exchanges:[],sectors:[]};n.selectOrUnSelectAll=function(){var i,r,u,e,t;if(n.customType!=1&&n.customType){if(i=n.stocksCount<n.tableParams.total()?n.stocksCount:n.tableParams.total(),n.selectedSecurities.length==0)r=n.searchParams.pageNumber,u=n.searchParams.pageSize,n.searchParams.pageNumber=1,n.searchParams.pageSize=n.stocksCount,e=n.searchParams.hideDisqualified,n.searchParams.hideDisqualified=!0,n.selectedSecurities=[],n.selectSecurityNum=i,f.getAllSecurities(n.searchParams).$promise.then(function(t){var i,f;for(n.searchParams.pageNumber=r,n.searchParams.pageSize=u,i=0;i<t.Securities.length;i++)n.selectedSecurities.push({select:!0,idSecurity:t.Securities[i].idSecurity});for(i=0;i<n.data.length;i++)f=n.selectedSecurities.filter(function(t){return t.idSecurity==n.data[i].idSecurity}),f.length>0&&(n.data[i].select=!0)}),n.searchParams.hideDisqualified=e;else for(n.selectSecurityNum=0,t=0;t<n.data.length;t++)n.data[t].select=!1;n.selectedSecurities=[]}};n.createPortfolio=function(){if(n.submit=!0,n.newPort.Exchanges=n.exchanges.map(function(n){return n.id}),n.$parent.isInProgress){o.showOKMessage("message","The system is already building a portfolio, please wait","OK");return}if(!n.newPort.Name||n.isValidPortfolioName()){if(n.portForm.$invalid){o.showOKMessage("message","Please fill in all required fields.","OK");return}if(!n.customType||n.customType==""){o.showOKMessage("message","Please select a Building Process.","OK");return}if(new Date(y.Licence.ExpiryDate)<new Date){o.showOKMessage("message","Your license has expired. You can no longer build new portfolios. Please contact us at info@gocherries.com to renew your license.","OK");return}if(n.$parent.getPortfolioList()!=null&&y.Licence.Service.Iportfolios<=n.$parent.getPortfolioList().length){o.showOKMessage("message","You've exceeded the number of portfolios you can create. Please delete any unwanted portfolios","OK");return}n.customType==1?n.createAutoPortfolio():n.createCustomPortfolio()}};n.createCustomPortfolio=function(){var t,i;if(!n.newPort.Name||!n.newPort.Equity){o.showOKMessage("error","Fill all portfolio details","OK");return}if(n.createNewPortfolio=!0,n.selectedSecurities.length==0){o.showOKMessage("message","Please select at least 1 security from the list below.","OK");return}for(n.newPort.Securities=[],t=0;t<n.selectedSecurities.length;t++)n.newPort.Securities.push(n.selectedSecurities[t].idSecurity);for(n.newPort.Exchanges=[],t=0;t<n.customExchanges.length;t++)n.newPort.Exchanges.push(n.customExchanges[t].id);n.$parent.saveNewPortfolio(n.newPort);i={Name:n.newPort.Name,Securities:n.newPort.Securities,Equity:n.newPort.Equity,Risk:0,CalcType:4,Exchanges:n.newPort.Exchanges};n.$parent.createPortfolio(i)};n.createAutoPortfolio=function(){if(n.newPort.Name&&n.newPort.Equity&&n.newPort.PreferedRisk&&n.exchanges.length!=0){if(n.newPort.Equity<g){o.showOKMessage("error","Investment amount must be "+s("number")(g,0)+n.currency+" or higher","OK");return}}else{o.showOKMessage("error","Fill all portfolio details","OK");return}n.newPort.PreferedRisk.Name=ft(n.newPort.PreferedRisk.RiskType);n.$parent.saveNewPortfolio(n.newPort);var t={Name:n.newPort.Name,Securities:[],Equity:n.newPort.Equity,Risk:n.newPort.PreferedRisk.RiskType,Exchanges:n.newPort.Exchanges,CalcType:n.newPort.PreferedRisk.RiskType>.03?enumEfCalculationType.BestRisk:enumEfCalculationType.BestTP};n.createNewPortfolio=!0;n.$parent.createPortfolio(t)};n.isValidPortfolioName=function(){return n.newPort&&n.newPort.Name&&n.newPort.Name.length>15?(o.showOKMessage("error","Invalid portfolio name – Please enter a name up to 15 characters","OK"),!1):n.newPort.Name.indexOf("/")>-1?(o.showOKMessage("error",'Invalid portfolio name – "/" is not allowed in portfolio name',"OK"),!1):!0};n.search=function(){clearTimeout(d);d=setTimeout(function(){n.tableParams.page(1);n.tableParams.reload()},500)};n.addOrRemoveToSectorList=function(t){if(t)if(t.select){if(n.selectSecurityNum==n.stocksCount){o.showOKMessage("message","You have reach the max securities you can select","OK");t.select=!1;return}n.selectSecurityNum=n.selectSecurityNum+1;n.selectedSecurities.push({select:!0,idSecurity:t.idSecurity})}else{n.selectSecurityNum=n.selectSecurityNum-1;for(var i=0;i<n.selectedSecurities.length;i++)if(n.selectedSecurities[i].idSecurity==t.idSecurity){n.selectedSecurities.splice(i,1);break}}};n.filterRiskChanged=function(){n.searchParams.maxRiskLevel=n.filterRiskLevel;w();p()};n.exchangesClosed=function(){w();var t=n.customExchanges.slice();it(nt,t,"id")||p();nt=t};n.sectorsClosed=function(){w();var t=n.sectors.slice();it(tt,t,"id")||p();tt=t};n.applyFilter=function(t){n.sectors=t.sectors.slice();n.customExchanges=t.exchanges.slice();n.filterRiskLevel=t.riskLevel;n.searchParams.maxRiskLevel=t.riskLevel;p()};n.filterChanged=p;n.setNewPortRiskType=function(t){n.newPort.PreferedRisk||(n.newPort.PreferedRisk={});n.customType!=2?(n.RiskType=t,n.newPort.PreferedRisk.RiskType=ut(t)):(n.RiskType=null,n.newPort.PreferedRisk.RiskType=null)};n.$watch("customType",function(n,t){n!=t&&n=="2"&&rt(1)},!0);n.$on("$destroy",function(){for(var t in n)t.indexOf("$")==1&&(n[t]=null)});var ut=function(n){switch(n){case 0:return 0;case 1:return 9/100;case 2:return 14/100;case 3:return 25/100;case 4:return 40/100;case 5:return 1}},ft=function(n){switch(n){case 0:return"TP";case 1:return"Solid";case 2:return"Low";case 3:return"Moderate";case 4:return"High";case 5:return"Very High"}},ct=function(t){var i=y.Currency.CurrencyId!="9001"?t.avgYield:t.avgYieldNIS;return i=s("number")(i*100,2),i*1>=n.returnValueFilter*1},rt=function(t){t=t==null?1:t;n.tableParams=new u({page:t,count:n.searchParams.pageSize},{total:n.data.length,counts:[],getData:function(t,i){n.searchParams.pageNumber=n.tableParams.page();n.searchParams.pageSize=n.tableParams.count();n.searchParams.exchangesPackagees=st();n.searchParams.sectors=ht();n.searchParams.hideDisqualified=!n.showDisqualified;f.getAllSecurities(n.searchParams).$promise.then(function(r){c(function(){var u,f;if(!r.Securities||r.Securities.length==0){o.showOKMessage("error","There are no securities available","OK");return}if(n.data=r.Securities,n.selectedSecurities.length>0)for(u=0;u<n.data.length;u++)f=n.selectedSecurities.filter(function(t){return t.idSecurity==n.data[u].idSecurity}),f.length>0&&(n.data[u].select=!0);i.total(r.NumOfRecords);n.currenPageCount=i.page()*i.count()<r.NumOfRecords?i.count():r.NumOfRecords-(i.page()-1)*i.count();t.resolve(n.data)},500)},function(){})}})},et=function(){var i=n.$parent.getLookupValues(),t;for(i!=null&&(n.sectorsOptions=i.Categories.Sector),t=0;t<n.sectorsOptions.length;t++)n.sectorsOptions[t].label=n.sectorsOptions[t].strValue;for(t=0;t<n.stockMarket.length;t++)n.stockMarket[t].label=n.stockMarket[t].HebName},ot=function(){function u(t){n.$apply(function(){n.bottomBtnVisible=!t})}n.$parent.selectMenu=2;n.newPortfolio=n.$parent.getNewPortfolio(e.name);y=n.$parent.getUser();n.stocksCount=y.Licence.Stocks.length*250;n.avgYield="AvgYield";n.stockMarketSettings={showCheckAll:!0,showUncheckAll:!0,idProp:"id",sellectAllDefault:!1,buttonDefaultText:"select",buttonClasses:"btn btn-default drop-btn",scrollable:!0,scrollableHeight:190};n.sectorsSettings={showCheckAll:!0,showUncheckAll:!0,idProp:"iIndex",sellectAllDefault:!1,buttonDefaultText:"select",buttonClasses:"btn btn-default drop-btn",scrollable:!0,scrollableHeight:190};n.columns=[{name:"strName",colwidth:3,paddingLeft:"3px"},{name:"strSymbol",colwidth:2,paddingLeft:"10px"},{name:"marketName",colwidth:1,paddingLeft:"14px"},{name:"sectorName",colwidth:2,paddingLeft:"16px"},{name:n.avgYield,isPercentage:!0,colwidth:2,paddingLeft:"22px"},{name:"rank",moreInfo:!0,isNumber:!0,colwidth:2,paddingLeft:"22px"},];n.mobileColumns={title:{primary:"strName",secondary:"strSymbol"},properties:[{name:"sectorName",title:"Sector"},{name:"marketName",title:"Exchange"},{name:"rank",title:"Rank",isNumber:!0}]};n.stockMarket=y.Licence.Stocks;et();n.filterDataSource.exchanges=n.stockMarket.map(function(n){return{id:n.id,label:n.HebName}});n.filterDataSource.sectors=n.sectorsOptions.map(function(n){return{id:n.iIndex,label:n.strValue}});w();n.customType=="2"&&rt(1);var t=r.find(".portfolio-custom__go-btn"),i=new a(t,u);v.register(i)};ot()}]);app.controller("optimizedPortfolioCtrl",["$scope","$rootScope","$location","$window","ngTableParams","securitiesSvc","$routeParams","$filter","portfolioSvc","utilitiesSvc","exportDataSvc","isMobile",function(n,t,i,r,u,f,e,o,s,h,c,l){var a,y,v=[],k,nt,tt=12,w=!1;n.solidData=[];n.lowData=[];n.moderateData=[];n.heighData=[];n.veryHighData=[];n.data=[];n.cashData={};n.selectPortfolio;n.selectProfessional="yourPort";n.chartOrderByField="percentage";n.isProfessionalView=!0;n.searchText="";n.weightChart="sector";n.search=function(){n.data=n.searchText==""?n.selectPortfolio.Securities:o("filter")(n.selectPortfolio.Securities,ut,!0);n.data=n.data.filter(function(n){return n.Quantity>=1});n.tableParams.page(1);n.tableParams.reload()};n.setSelectPortfolio=function(t){t>=n.portfolios.length&&(t=n.portfolios.length-1);n.selectPortfolio=n.portfolios[t];a.PortNumA=t;n.selectPortfolio.Securities.length-1<4&&!w&&!l.phone&&(w=!0,h.showOKMessageWithIndication("Warning","Your portfolio is not well diversified. For a more diversified portfolio, please select any of the portfolios to the left of yours along the Efficient Frontier.","OK").then(function(){w=!1}));a.PortNumA=t;b();p()};n.setSelectProfessional=function(t){n.selectProfessional=t;switch(t){case"MVP":n.selectPortfolio=n.mvpPort;a.PortNumA=0;break;case"yourPort":n.selectPortfolio=n.yourPort;a.PortNumA=a.OrigPortPos;break;case"TP":n.selectPortfolio=n.tpPort;a.PortNumA=a.TangencyPos}b();p(!0)};n.updatePortdolio=function(){if(a.PortNumA!=a.OrigPortPos){var i={PortID:a.PortID,Securities:n.selectPortfolio.Securities.filter(function(n){return n.Name!="Cash"}),Equity:n.newPort.PortDetails.Equity,Risk:n.selectPortfolio.Risk,CalcType:1};s.updatePortfolio(i).$promise.then(function(){h.showOKMessage("message","Portfolio saved successfully.","OK");a.OrigPortPos=a.PortNumA;t.$broadcast("updateScetcherTagsAndRedPoint");d();p()},function(){h.showOKMessage("error","failed save data","OK")})}else h.showOKMessage("message","Portfolio saved successfully.","OK")};n.export=function(){var t={portID:a.PortID,OptimalPort:n.selectPortfolio};s.exportOptimize(t).$promise.then(function(n){c.download(n.Data,"",n.Name)})};n.changeOrderByBarChart=function(){g()};var it=function(){(a=n.$parent.getNewPortfolioObj(),n.portfolios=a.Portfolios,n.newPort.PortID=a.PortID,n.portDetails=a.PortDetails,n.changeFromYesterday=n.portDetails.CurrEquity-n.portDetails.Equity+n.portDetails.Profit,n.equityCalc=n.portDetails.Equity+n.portDetails.Profit,n.portfolios!=null)&&(n.selectPortfolio=n.portfolios[a.PortNumA],b(),n.mvpPort=n.portfolios[0],n.yourPort=n.portfolios[a.OrigPortPos],n.tpPort=n.portfolios[a.TangencyPos],d(),p())},b=function(){n.selectPortfolio&&(n.riskColorName=rt(n.selectPortfolio.Risk),n.riskColor=n.riskColors[n.riskColorName])},rt=function(n){var t=o("number")(n*100,2)*1;switch(!0){case t>0&&t<=9:return"Solid";case t>9&&t<=14:return"Low";case t>14&&t<=25:return"Moderate";case t>25&&t<=40:return"High";case t>40&&t<=100:return"Very High"}return"none"},ut=function(t){return t?t.Name&&t.Name.toLowerCase().indexOf(n.searchText.toLowerCase())!=-1:!1},p=function(){n.data=n.selectPortfolio.Securities.slice();n.data=n.data.filter(function(n){return n.Quantity>=1});var t={Name:"Cash",Symbol:"",marketName:"",sectorName:"",Quantity:"",DisplayValue:n.selectPortfolio.Cash};n.data.push(t);g();ot();n.tableParams.page(1);n.tableParams.reload()},ft=function(){n.tableParams=new u({page:1,count:tt},{total:n.data.length,counts:[],getData:function(t,i){nt=i.page();i.total(n.data.length);n.data&&n.data.length>0?t.resolve(n.data.slice((i.page()-1)*i.count(),i.page()*i.count())):t.resolve(n.data)}})},ct=function(n,t,i,r){return i==0||i==r?n+"%":n>0&&n<=9&&t>9&&t<=23||n>9&&n<=23&&t>23&&t<=40||n>23&&n<=40&&t>40&&t<=70||n>40&&n<=70&&t>70&&t<=100?n+"%":""},et=function(t,i){for(var u=["solidData","lowData","moderateData","heighData","veryHighData"],r=0;r<5;r++)if(n[u[r]].push({x:o("number")(y[r+1].LowerBound*100,2),y:0}),i>=y[r+1].UpperBound)n[u[r]].push({x:o("number")(y[r+1].UpperBound*100,2),y:0});else if(i<y[r+1].UpperBound){n[u[r]].push({x:o("number")(i*100,2),y:0});return}};String.format=function(n){var t=arguments;return n.replace(/{[0-9]}/g,function(n){t[parseInt(n.replace(/[{}]/g,""))+1]})};var d=function(i){var f,e,s,h,u,c,l;for(n.lineLabels=[],n.lineData=[],n.portfolios=o("orderBy")(n.portfolios,"Risk",!1),k=n.portfolios,n.solidData=[],n.lowData=[],n.moderateData=[],n.heighData=[],n.veryHighData=[],v=[],et(o("number")(n.portfolios[0].Risk,2),o("number")(n.portfolios[n.portfolios.length-1].Risk,5)),f=0,e=[],u=0;u<n.portfolios.length;u++)s=o("number")(n.portfolios[u].Risk*100,1),h=o("filter")(v,{x:s},!0),h&&h.length!=0?e.push(u):(v.push({x:s,y:o("number")(n.portfolios[u].Return*100,2)}),u==0&&(v[f].tagLabel="MVP"),u==a.OrigPortPos&&(u==0?v[f].tagLabel+=" and Opt":v[f].tagLabel="Opt"),u==a.TangencyPos&&(v[f].tagLabel!=undefined?v[f].tagLabel+=" and TP":v[f].tagLabel="TP"),f=f+1);for(u=0;u<e.length;u++)n.portfolios.splice(e[u],1);n.lineData=[{pointDot:!0,strokeColor:"rgb(218,218,218)",pointColor:"rgb(45,62,80)",scaleSteps:10,scaleStepWidth:10,scaleLineWidth:5,xScaleOverride:!0,scaleShowLabels:!0,data:v}];n.solidData.length>0&&n.lineData.push({pointDot:!1,strokeColor:"green",data:n.solidData});(n.lowData.length>0||n.solidData.length>0)&&n.lineData.push({pointDot:!1,strokeColor:"yellow",data:n.lowData});(n.moderateData.length>0||n.lowData.length>0)&&n.lineData.push({pointDot:!1,strokeColor:"rgb(240, 187, 2)",data:n.moderateData});(n.heighData.length>0||n.moderateData.length>0)&&n.lineData.push({pointDot:!1,strokeColor:"darkorange",data:n.heighData});(n.veryHighData.length>0||n.heighData.length>0)&&n.lineData.push({pointDot:!1,strokeColor:"red",data:n.veryHighData});var y=o("number")(n.portfolios[n.portfolios.length-1].Risk*100,2)*1,p=o("number")(n.portfolios[0].Risk*100,2)*1,w=(y-p)*1;n.lineOptions={selectPointColor:"red",scaleLabel:"<%=value%>%",scaleArgLabel:"<%=value%>%",precenLabel:!1,tagWithPath:!0,xScaleSteps:20,selectionLine:!1,xScaleStepWidth:20,xScaleStartValue:0,scaleShowLabels:!0,scaleBeginAtZero:!0,ySelect:o("number")(n.portfolios[0].Return,2),xSelect:o("number")(n.portfolios[0].Risk*100,2),series:[{text:"Solid: 0%-9%",color:"#2fd074"},{text:"Low: 9%-14%",color:"#f9ec23"},{text:"Moderate: 14%-25%",color:"#f9b50a"},{text:"High:25%-40%",color:"#ff8812"},{text:"Very High:40%-100%",color:"#fc3d5e"}],tooltipTemplate:function(n,t){if(!n.display)return"";if(n.index!=null&&n.index>=0){var t=k[n.index];return"Risk: "+o("number")(t.Risk*100,2)+"% \n Average yearly return: "+o("number")(t.Return*100,2)+"% \n Return To Risk Ratio: "+o("number")(t.RateToRisk,2)+" \n Diversification: "+o("number")(t.Diversification*100,1)+"% \n "}return n.label+": "+n.value},showMultiToolTip:!1};c=/(MSIE|Trident\/|Edge\/)/i.test(r.navigator.userAgent);l=c?6e3:2e3;setTimeout(function(){t.$broadcast("initLineScattertest",i);n.setSelectPortfolio(a.PortNumA)},l)},g=function(){var u,f,e,i,r;for(n.barLabels=[],n.barData=[],n.barData1=[],u=n.chartOrderByField=="percentage"?"Weight":"Symbol",f=n.chartOrderByField=="percentage"?!0:!1,n.selectPortfolio.Securities=o("orderBy")(n.selectPortfolio.Securities,u,f),e=n.selectPortfolio.Securities.length<325?n.selectPortfolio.Securities.length:325,i=0;i<e;i++)n.selectPortfolio.Securities[i].Symbol!=""&&(r=o("number")(n.selectPortfolio.Securities[i].Weight*100,2),n.barLabels.push(n.selectPortfolio.Securities[i].Symbol),n.barData.push(r*1),n.barData1.push({id:r*1}));n.barOptions={scaleLabel:"<%=value%>%",fillColor:["#6C94BF","#2D3E50","#496481"],strokeColor:["#6C94BF","#2D3E50","#496481"],pointColor:"#6C94BF",barStrokeWidth:5,barValueSpacing:1,barDatasetSpacing:10};setTimeout(function(){t.$broadcast("initChartBar","optSecurities",screen.width-200)},1500)},ot=function(){var f=["#364a60","#496481","#7eaddf","#2d3e58","#5a7b9f","#6c94bf","#89BDF3"],e=[],s=[],u,i;n.stockData=[];n.sectorData=[];var l=[],a=[],h=0,c=0,r=n.selectPortfolio.Securities.filter(function(n){return n.sectorName!=""});for(i=0;i<r.length;i++)u=o("filter")(e,{id:r[i].idMarket},!0),u.length>0?u[0].value=u[0].value+1:e.push({name:r[i].marketName,value:1,id:r[i].idMarket});for(i=0;i<e.length;i++)f.length<i&&(h=0),l.push({text:e[i].name,color:f[h]}),n.stockData.push({label:e[i].name,value:e[i].value*100/r.length,color:f[h],labelColor:"white",labelFontSize:"16"}),h=h+1;for(i=0;i<r.length;i++)u=o("filter")(s,{id:r[i].idSector},!0),u.length>0?u[0].value=u[0].value+1:s.push({name:r[i].sectorName,value:1,id:r[i].idSector});for(i=0;i<s.length;i++)f.length<i&&(c=0),a.push({text:s[i].name,color:f[c]}),n.sectorData.push({label:s[i].name,value:s[i].value*100/r.length,color:f[i],labelColor:"white",labelFontSize:"16"}),c=c+1;n.stockOptions={segmentShowStroke:!1,showTooltips:!1,series:l,tooltipTemplate:function(n){return n.label+": "+n.value}};n.sectorOptions={showTooltips:!1,segmentShowStroke:!1,series:a,tooltipTemplate:function(n){return n.label+": "+n.value}};setTimeout(function(){t.$broadcast("initChartPie","stockPieChart");t.$broadcast("initChartPie","sectorPieChart");t.$broadcast("initChartPie","stockPieChartMobile");t.$broadcast("initChartPie","sectorPieChartMobile")},1e3)},st=function(){var t=n.$parent.getLookupValues();t!=null&&(y=t.PortRisks)},ht=function(){n.$parent.selectMenu=0;n.riskColors=riskColors;n.chartName="lineChart";ft();n.newPort=n.$parent.getNewPortfolio(e.name);st();it();n.columns=[{name:"Name",colwidth:3},{name:"Symbol",colwidth:1},{name:"marketName",colwidth:2},{name:"Weight",colwidth:1,isPercentage:!0},{name:"sectorName",colwidth:2,paddingLeft:"3px"},{name:"Quantity",isNumber:!0,truncate:!0,colwidth:1},{name:"DisplayValue",isNumber:!0,decimalPoins:2,colwidth:2,moreInfo:!0}];n.mobileColumns={title:{primary:"Name",secondary:"Symbol"},properties:[{name:"Quantity",title:"Quantity",truncate:!0},{name:"Weight",title:"Weight",isPercentage:!0},{name:"DisplayValue",title:"Value",isNumber:!0,decimalPoins:2}]};n.mobileCashColumns={isCash:!0,title:{primary:"Name"},cacheField:"DisplayValue"};user=n.$parent.getUser();n.currency=n.$parent.getLookupValues().Currencies.filter(function(t){return t.CurrencyId==n.portDetails.CalcCurrency})[0].CurrencySign;n.currencyId=n.$parent.getLookupValues().Currencies.filter(function(t){return t.CurrencyId==n.portDetails.CalcCurrency})[0].CurrencyId;n.currDay=new Date;l.phone&&h.showOKMessage("message","Please enable popups for portfolio export","OK")};ht()}]);app.controller("portfolioDetailsCtrl",["$scope","$rootScope","$location","$window","ngTableParams","securitiesSvc","$routeParams","$filter","portfolioSvc","utilitiesSvc",function(n,t,i,r,u,f,e,o,s,h){var c,l;n.portfolio;n.data=[];n.chartOrderByField="percentage";n.cashData={};n.searchText="";c=-1;l=12;n.search=function(){n.data=n.searchText==""?n.portfolio.SecurityData:o("filter")(n.portfolio.SecurityData,w,!0);n.data=n.data.filter(function(n){return n.flQuantity>=1});n.tableParams.page(1);n.tableParams.reload()};n.updatechartSize=function(){};n.calculate=function(){var t,r,u;if(!n.lastPeriod||!n.Lenchmark){h.showOKMessage("message","Please fill benchMark index and last period.","OK");return}t=1;n.lastPeriod==2&&(t=6);n.lastPeriod==3&&(t=12);r=new Date;r.setMonth(r.getMonth()-t);u={portName:n.portfolio.Name,PortID:n.portfolio.ID,Equity:n.portfolio.Equity,StartDate:r,EndDate:new Date,BenchMarkID:n.Lenchmark};n.$parent.saveBacktestingParams(u);i.path("backtesting")};n.changePortfolio=function(){y()};n.exportToPdf=function(){var t=n.data.length<39?n.data.length:39;a(t,1);h.exportToPdf("portDetails","portfolio "+n.portfolio.Name).then(function(){n.data.length>39?v(t,2,n.data.length/39):a(12,1)})};var a=function(t,i){n.tableParams.count(t);n.tableParams.page(i);n.tableParams.reload()},v=function(t,i,r){a(t,i);h.exportToPdf("portSecurities","portfolio "+n.portfolio.Name).then(function(){i<r?(v(t,i+1,r),i=i+1):a(12,1)})},w=function(t){return t?t.strName&&t.strName.toLowerCase().indexOf(n.searchText.toLowerCase())!=-1:!1},y=function(){s.getSinglePortfolio(n.portfolioId).$promise.then(function(t){n.portfolio=t.Details[0];n.data=o("orderBy")(n.portfolio.SecurityData,"SecValue",!0);n.data=n.data.filter(function(n){return n.flQuantity>=1});n.riskName=g(n.portfolio.CurrentStDev);n.riskColor=n.riskColors[n.riskName];n.changeFromYesterday=n.portfolio.CurrEquity-n.portfolio.Equity+n.portfolio.Profit;n.changeIcon=n.changeFromYesterday>0?"arrow_up":"arrow_down";n.cashData={strName:"Cash",strSymbol:"",marketName:"",sectorName:"",flQuantity:"",SecValue:n.portfolio.Cash};n.currency=n.$parent.getLookupValues().Currencies.filter(function(t){return t.CurrencyId==n.portfolio.CalcCurrency})[0].CurrencySign;n.currencyId=n.$parent.getLookupValues().Currencies.filter(function(t){return t.CurrencyId==n.portfolio.CalcCurrency})[0].CurrencyId;var i=n.portfolio.CalcCurrency!="9001"?"dValueUSA":"dValueNIS";n.columns=[{name:"strName",colwidth:3,paddingLeft:"2px"},{name:"strSymbol",colwidth:1},{name:"marketName",colwidth:2,margin:"-12px"},{name:"portSecWeight",colwidth:1,isPercentage:!0,margin:"-8px"},{name:"sectorName",colwidth:2,paddingLeft:"7px"},{name:"flQuantity",isNumber:!0,colwidth:1},{name:"SecValue",isNumber:!0,decimalPoins:2,colwidth:1,paddingLeft:"10px"},{name:"Profit",colwidth:1,moreInfo:!0,isProfit:!0}];n.cacheColumns=[{name:"strName",colwidth:3,paddingLeft:"2px"},{name:"Mock",colwidth:7},{name:"SecValue",isNumber:!0,decimalPoins:2,colwidth:2,paddingLeft:"5px",moreInfo:!0}];n.mobileColumns={isCash:!1,title:{primary:"strName",secondary:"strSymbol"},profit:"Profit",properties:[{name:"flQuantity",title:"Quantity",isNumber:!0},{name:"portSecWeight",title:"Weight",isPercentage:!0},{name:"SecValue",title:"Current Value",isNumber:!0,decimalPoins:2}]};n.mobileCachColumns={isCash:!0,title:{primary:"strName"},cacheField:"SecValue",profitSpacer:!0};b()},function(){})},b=function(){p();d();n.tableParams.page(1);n.tableParams.reload()},k=function(){n.tableParams=new u({page:1,count:l},{total:n.data.length,counts:[],getData:function(t,i){c=i.page();i.total(n.data.length);n.data&&n.data.length>0?t.resolve(n.data.slice((i.page()-1)*i.count(),i.page()*i.count())):t.resolve(n.data)}})};n.showCashRow=function(){if(!n.data)return!1;var t=Math.floor(n.data.length/l);return(c-1==t||n.data.length%l==0&&c==t)&&(n.searchText==""||"cash".toLowerCase().indexOf(n.searchText.toLowerCase())!=-1)};n.changeOrderByBarChart=function(){p()};var p=function(){var i;n.barLabels=[];n.barData=[];n.barData1=[];n.deleteSecuritiesMone=0;var r=n.portfolio.SecurityData.length<327?n.portfolio.SecurityData.length:327,u=n.chartOrderByField=="percentage"?"portSecWeight":"strSymbol",f=n.chartOrderByField=="percentage"?!0:!1;for(n.portfolio.SecurityData=o("orderBy")(n.portfolio.SecurityData,u,f),i=0;i<r;i++)n.portfolio.SecurityData[i].strSymbol!=""&&(n.barLabels.push(n.portfolio.SecurityData[i].strSymbol),n.barData.push(o("number")(n.portfolio.SecurityData[i].portSecWeight*100,2)),n.barData1.push({id:o("number")(n.portfolio.SecurityData[i].portSecWeight*100,2)}));n.barOptions={scaleLabel:"<%=value%>%",fillColor:["#6C94BF","#2D3E50","#496481"],strokeColor:["#6C94BF","#2D3E50","#496481"],pointColor:"#6C94BF",barStrokeWidth:5,barValueSpacing:1,barDatasetSpacing:10};setTimeout(function(){t.$broadcast("initChartBar","portSecurities",screen.width-200)},1e3)},d=function(){var f,h,i;n.stockData=[];n.sectorData=[];var u=["#364a60","#496481","#7eaddf","#2d3e58","#5a7b9f","#89BDF3","#6c94bf"],e=[],s=[],l=[],a=[],c=0,r=n.portfolio.SecurityData.filter(function(n){return n.sectorName!=""});for(i=0;i<r.length;i++)f=o("filter")(e,{id:r[i].idMarket},!0),f.length>0?f[0].value=f[0].value+1:e.push({name:r[i].marketName,value:1,id:r[i].idMarket});for(i=0;i<e.length;i++)u.length-1<c&&(c=u.length+1==e.length?1:0),l.push({text:e[i].name,color:u[c]}),n.stockData.push({label:e[i].name,value:e[i].value*100/r.length,color:u[c],labelColor:"#ffffff",labelFontSize:"16"}),c=c+1;for(i=0;i<r.length;i++)f=o("filter")(s,{id:r[i].idSector},!0),f.length>0?f[0].value=f[0].value+1:s.push({name:r[i].sectorName,value:1,id:r[i].idSector});for(h=0,i=0;i<s.length;i++)u.length-1<h&&(h=u.length+1==s.length?1:0),a.push({text:s[i].name,color:u[h]}),n.sectorData.push({value:s[i].value*100/r.length,color:u[h],label:s[i].name,labelColor:"white",labelFontSize:"16"}),h=h+1;n.stockOptions={segmentShowStroke:!1,showTooltips:!1,series:l,tooltipTemplate:function(n){return n.label+": "+n.value}};n.sectorOptions={showTooltips:!1,segmentShowStroke:!1,series:a,tooltipTemplate:function(n){return n.label+": "+n.value}};setTimeout(function(){t.$broadcast("initChartPie","stockPieChart");t.$broadcast("initChartPie","sectorPieChart");t.$broadcast("initChartPie","stockPieChartMobile");t.$broadcast("initChartPie","sectorPieChartMobile")},1e3)},tt=function(){(n.benchmarkSecurities=n.$parent.getBenchmarkSecurities(),n.benchmarkSecurities==null)&&f.getBenchmarkSecurities().$promise.then(function(t){n.benchmarkSecurities=t.Securities;n.$parent.saveBenchmarkSecurities(t.Securities)},function(){n.$parent.saveBenchmarkSecurities([{$id:"2",ID:"0.1297",Name:"NYSE Composite"},{$id:"3",ID:"0.2020",Name:"S&P 500 Index"},{$id:"4",ID:"0.5177",Name:"Nasdaq 100"},{$id:"5",ID:"137",Name:"TA – 100"},{$id:"6",ID:"142",Name:"TA – 25"},{$id:"7",ID:"143",Name:"TA – 75"},{$id:"8",ID:"147",Name:"TA MidCap – 50"},{$id:"9",ID:"164",Name:"TA – Banking"},{$id:"10",ID:"168",Name:"TA – Composite"},{$id:"11",ID:"2",Name:"General Share"},{$id:"12",ID:"709",Name:"Tel – Bond 60"}])})},g=function(n){var t=o("number")(n*100,2)*1;switch(!0){case t>0&&t<=9:return"Solid";case t>9&&t<=14:return"Low";case t>14&&t<=25:return"Moderate";case t>25&&t<=40:return"High";case t>40&&t<=100:return"Very High"}return"#ffffff"},nt=function(){n.$parent.selectMenu=0;n.portfolioId=e.id;n.portfolios=n.$parent.getPortfolioList();y();k();n.periods=[{ID:1,Name:"last month"},{ID:2,Name:"last 6 month"},{ID:3,Name:"last year"}];n.riskColors=riskColors;var t=n.$parent.getUser();n.currDay=new Date};nt()}]);app.controller("registrationCtrl",["$scope","$location","$window","lookupSvc","utilitiesSvc","$timeout","ngTableParams","$filter","userSvc","licenseSvc","$rootScope",function(n,t,i,r,u,f,e,o,s){n.screenName="";n.user={};n.data=[];n.years=[];n.validTrailForm=!1;n.submitForm=!1;n.model={User:{Licence:{Service:{},Stocks:[],Transaction:{}}}};n.checkConfirmEmail=function(){if(n.model.User.Email&&(n.model.User.Email=n.model.User.Email.trim()),n.confirmEmail&&(n.confirmEmail=n.confirmEmail.trim()),n.confirmEmail!=""&&n.confirmEmail!=null&&n.model.User.Email!=null&&n.model.User.Email!=""&&n.confirmEmail!=n.model.User.Email){u.showOKMessage("error","Confirm email not equal to email","OK",!1,!0);return}};n.next=function(i){var r,e,f;if(n.submitForm=!0,r="",e=(new Date).getFullYear()-18,i.$invalid&&(r=r+"Please fill all required fields <br/>"),n.model.User.Name&&!/^([ a-zA-Z0-9])*$/.test(n.model.User.Name)&&(r=r+"Insert only english characters and digits to name<br/>",i.fullname.$invalid=!0),n.model.Password&&!/^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$/.test(n.model.Password)&&(r=r+"Invalid password <br/>",i.passInput.$invalid=!0),n.confirmPassword&&!/^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$/.test(n.confirmPassword)&&(r=r+"Invalid confirm password <br/>",i.passInput2.$invalid=!0),n.model.Password!=n.confirmPassword&&(r=r+"Your password not equal to confirm password <br/>"),n.model.User.Email&&!/^([\w\.\-]+)@([\w\-]+)((\.(\w){2,3})+)$/.test(n.model.User.Email)&&(r=r+"Invalid Email <br/>",i.email.$invalid=!0),n.confirmEmail&&!/^([\w\.\-]+)@([\w\-]+)((\.(\w){2,3})+)$/.test(n.confirmEmail)&&(r=r+"Invalid confirm Email <br/>",i.confirmEmail.$invalid=!0),n.model.User.Email!=n.confirmEmail&&(r=r+"Your email not equal to confirm email <br/>"),r!=""){u.showOKMessage("error",r,"OK",!1,!0);return}n.model.User.Username=n.model.User.Email;f={Username:n.model.User.Email};s.verifyUsername(f).$promise.then(function(){sessionStorage.setItem("tempUser",JSON.stringify(n.model));t.path("/registrationTrial")})};n.verifyConfirmCode=function(){n.confirmCodeValue&&s.verifyConfirmCode({ConfirmCode:n.confirmCodeValue}).$promise.then(h,c)};var p=function(){u.showOKMessage("message","Authentication code sent to your email","OK",!1,!0)},w=function(n){u.showOKMessage("error",n[0]?n[0].Text:n.data.Message,"OK",!1,!0)},h=function(){n.model.User.Username=n.model.User.Email;sessionStorage.setItem("tempUser",JSON.stringify(n.model));t.path("/registrationPayment")},c=function(t){u.showOKMessage("error",t[0]?t[0].Text:t.data.Message,"OK",!1,!0);n.canCalculate=!1},l=function(){r.getLookup().$promise.then(a,v)},a=function(t){var r,i;for(n.stockMarket=[],r=t.Categories.StockMarket,i=0;i<r.length;i++)n.stockMarket.push({id:r[i].iIndex,label:r[i].strValue});n.stockMarketSettings={showCheckAll:!1,showUncheckAll:!1,idProp:"label",scrollable:!0,scrollableHeight:120};n.data=t.Services;n.countries=t.Countries;n.districts=t.Districts;n.genders=t.Genders;n.currencies=t.Currencies},v=function(){},y=function(){l();n.currentYear=(new Date).getFullYear();for(var t=n.currentYear-18;t>n.currentYear-78;t--)n.years.push(t)};y()}]);app.controller("registrationTrialCodeCtrl",["$scope","$location","utilitiesSvc","$filter","userSvc","lookupSvc",function(n,t,i,r,u,f){n.termCondPolicy=!1;n.screenName="";n.user={};n.data=[];n.model={User:{Licence:{Service:{},Stocks:[],Transaction:{}}}};n.saveTrialUser=function(){if(!n.termCondPolicy){i.showOKMessage("error","You must agree to Cherries' Terms & Conditions and Privacy Policy in order to create an account","OK",!1,!0);return}if(!n.model.Cupon||n.model.Cupon==""){i.showOKMessage("error","Invalid coupon code","OK",!1,!0);return}var t=new Date;e(!0,4);n.model.User.Licence.ExpiryDate=r("date")(new Date(t.setDate(t.getDate()+14)),"MMM dd/yy");n.model.User.Licence.Transaction={TransactionDate:r("date")(t,"MMM dd/yy")};n.model.User.Licence.isTrial=!0;u.createUser(n.model).$promise.then(o,s)};var e=function(t,i){var u=new Date;n.model.User.Licence.Licensetype=t?Licensetype.Trial:Licensetype.FullLicense;n.model.User.Licence.Service.Idlicservice=i;n.model.User.Licence.ActivationDate=r("date")(u,"MMM dd/yy");n.model.User.Licence.PurchaseDate=r("date")(u,"MMM dd/yy")},o=function(){i.showOKMessage("message","User created successfully","OK",!1,!0);t.path("/")},s=function(n){i.showOKMessage("message",n[0]?n[0].Text:n.data.Message,"OK")},h=function(t){var r,i;for(n.stockMarket=[],r=t.Categories.StockMarket,i=0;i<r.length;i++)n.stockMarket.push({id:r[i].iIndex,label:r[i].strValue});n.model.User.Licence.Stocks=n.stockMarket},c=function(n){i.showOKMessage(messagesType.error,n.Messages[0].Text,buttonsType.OK)},l=function(){n.formReady=!1;f.getLookup().$promise.then(h).catch(c).finally(function(){n.formReady=!0})},a=function(){n.model=JSON.parse(sessionStorage.getItem("tempUser"));l()};a()}]);app.controller("changeAccountDetailsCtrl",["$scope","$location","lookupSvc","utilitiesSvc","$filter","userSvc","$window",function(n,t,i,r,u,f,e){n.model={};n.updateUserDetails=function(t){if(t.$invalid){r.showOKMessage("error","Please fill all required fields","OK");return}n.model.User.YearOfBirth=Number(n.model.User.YearOfBirth);n.model.User.Currency=u("filter")(n.currencies,{CurrencyId:n.model.User.Currency.CurrencyId},!0)[0];f.updateUesrDetails(n.model).$promise.then(o,s)};n.back=function(){e.history.back()};var o=function(){r.showOKMessage(messagesType.message,"Account details updated successfully",buttonsType.OK)},s=function(n){r.showOKMessage(messagesType.error,n.Messages[0].Text,buttonsType.OK)},h=function(){i.getLookup().$promise.then(c,l)},c=function(t){n.countries=t.Countries;n.districts=t.Districts;n.genders=t.Genders;n.currencies=t.Currencies;n.model={User:n.$parent.getFullUser()}},l=function(){},a=function(){h();n.currentYear=(new Date).getFullYear()};a()}]);app.controller("changeBillingDetailsCtrl",["$scope","$rootScope","$location","lookupSvc","utilitiesSvc","$filter","userSvc","ngTableParams","licenseSvc","$window",function(n,t,i,r,u,f,e,o,s,h){var c,a,l;n.model={SumInServer:null};n.data=[];n.servicePack={};n.disablePaypal=!0;a=[];n.calculateLicense=function(){if(!l(!0))return!1;n.validForm=!0;var t={ServiceID:n.servicePack.selectBillingRow,StockCount:n.model.Stocks.length};s.calculateLicense(t).$promise.then(function(t){n.model.SumInServer=t.Sum;n.disablePaypal=!1},function(n){u.showOKMessage("error",n.data,"OK")})};t.$$listeners.paypalPaymentComplited=[];t.$on("paypalPaymentComplited",function(t,i){n.updateUserLicence(i)});n.canUsePaypal=function(){return l(!1)&&n.model.SumInServer!=null};l=function(t){return!n.servicePack||!n.servicePack.selectBillingRow?(t&&u.showOKMessage(messagesType.error,"You must choose your billing plan",buttonsType.OK),!1):!n.model||n.model.Stocks.length<2?(n.validForm=!1,t&&u.showOKMessage("error","You must choose at least 2 stocks","OK"),!1):!0};n.updateUserLicence=function(){if(!l(!0))return!1;n.model.Idlicservice=n.servicePack.selectBillingRow;s.updateUserLicence(n.model).$promise.then(v,y)};n.back=function(){h.history.back()};var v=function(t){n.$parent.updateUserLicence(t.License);u.showOKMessage(messagesType.message,"Account Details updated successfully",buttonsType.OK);h.history.back()},y=function(n){u.showOKMessage(messagesType.error,n.Messages[0].Text,buttonsType.OK)},p=function(){n.tableParams=new o({page:1,count:24},{total:n.data.length,counts:[],getData:function(t,i){i.total(n.data.length);t.resolve(n.data);k()}})},w=function(){r.getLookup().$promise.then(b,d)},b=function(t){var r,i;for(n.stockMarket=[],r=t.Categories.StockMarket,i=0;i<r.length;i++)n.stockMarket.push({id:r[i].iIndex,label:r[i].strValue});n.stockMarketSettings={showCheckAll:!1,showUncheckAll:!1,idProp:"label",scrollable:!0,scrollableHeight:120};n.data=t.Services;n.countries=t.Countries;n.districts=t.Districts;n.genders=t.Genders;n.tableParams.reload()},k=function(){n.servicePack.selectBillingRow=c.Licence.Service.Idlicservice},d=function(){},g=function(){p();w();c=n.$parent.getFullUser();n.selectCurrencySign=c.Currency.CurrencySign;for(var t=0;t<c.Licence.Stocks.length;t++)a.push(c.Licence.Stocks[t]);n.model={Transaction:c.Licence.Transaction,Stocks:a,UserID:c.UserID,LicenseID:c.Licence.LicenseID,SumInServer:null}};g()}]);app.controller("createBacktestingCtrl",["$scope","$location","$window","ngTableParams","securitiesSvc","$routeParams","utilitiesSvc","$filter","lookupSvc","$timeout","isMobile",function(n,t,i,r,u,f,e,o,s,h,c){function tt(n,t,i){return i?(n.sort(function(n,t){return n[i]-t[i]}),t.sort(function(n,t){return n[i]-t[i]})):(n.sort(),t.sort()),angular.equals(n,t)}function a(){var i=(n.exchangesFilter||[]).map(function(n){return n.id}),t;angular.forEach(n.filterDataSource.exchanges,function(n){n.selected=i.indexOf(n.id)>=0});t=(n.sectors||[]).map(function(n){return n.id});angular.forEach(n.filterDataSource.sectors,function(n){n.selected=t.indexOf(n.id)>=0});n.filterDataSource.riskLevel=n.searchParams.maxRiskLevel}function v(){n.customType==2&&(p=n.sectors.map(function(n){return n.id}),y=n.exchangesFilter.map(function(n){return n.id}),n.tableParams.page(1),n.tableParams.reload())}function ht(){return y.length>0?y.slice():n.stockMarket.map(function(n){return n.id})}function ct(){return p.length>0?p.slice():n.sectorsOptions.map(function(n){return n.iIndex})}var l,b=0,k=0,d=[],g=[],y=[],p=[],w,nt;n.searchParams={exchangesPackagees:[],sectors:[],maxRiskLevel:0,pageNumber:1,pageSize:c.phone?20:50,searchText:"",field:"strName",direction:"asc",hideDisqualified:!0};n.showDisqualified=!1;n.riskFilter;n.data=[];n.selectedSecurities=[];n.selctesItemsNum=null;n.searchText;n.selectSecurityNum=0;n.isRiskFilter=null;n.dataLength;n.exchanges=[];n.exchangesFilter=[];n.sectorsOptions=[];n.sectors=[];n.newPort={Exchanges:[],benchMarks:[]};n.filterDataSource={exchanges:[],sectors:[]};n.selectOrUnSelectAll=function(){var i,r,f,e,t;if(n.customType&&n.customType!=1){if(i=n.stocksCount<n.tableParams.total()?n.stocksCount:n.tableParams.total(),n.selectedSecurities.length==0)r=n.searchParams.pageNumber,f=n.searchParams.pageSize,n.searchParams.pageNumber=1,n.searchParams.pageSize=n.stocksCount,e=n.searchParams.hideDisqualified,n.searchParams.hideDisqualified=!0,n.selectedSecurities=[],n.selectSecurityNum=i,u.getAllSecurities(n.searchParams).$promise.then(function(t){var i,u;for(n.searchParams.pageNumber=r,n.searchParams.pageSize=f,i=0;i<t.Securities.length;i++)n.selectedSecurities.push({select:!0,idSecurity:t.Securities[i].idSecurity});for(i=0;i<n.data.length;i++)u=n.selectedSecurities.filter(function(t){return t.idSecurity==n.data[i].idSecurity}),u.length>0&&(n.data[i].select=!0)}),n.searchParams.hideDisqualified=e;else for(n.selectSecurityNum=0,t=0;t<n.data.length;t++)n.data[t].select=!1;n.selectedSecurities=[]}};n.createBacktesting=function(){(n.submit=!0,n.newPort.Exchanges=n.exchanges.map(function(n){return n.id}),rt())&&(n.customType==1?n.createAutoBacktesting():n.createCustomBacktesting())};n.createCustomBacktesting=function(){var t;if(!n.newPort.Name||!n.newPort.Equity){e.showOKMessage("error","Fill all portfolio details","OK");return}if(n.createNewPortfolio=!0,n.selectedSecurities.length==0){e.showOKMessage("message","Please select at least 1 security from the list below.","OK");return}for(n.newPort.Securities=[],t=0;t<n.selectedSecurities.length;t++)n.newPort.Securities.push(n.selectedSecurities[t].idSecurity);for(n.newPort.Exchanges=[],t=0;t<n.exchangesFilter.length;t++)n.newPort.Exchanges.push(n.exchangesFilter[t].id);w(4,n.newPort.Securities)};n.createAutoBacktesting=function(){if(n.newPort.Name&&n.newPort.Equity&&n.exchanges.length!=0){if(n.newPort.Equity<k){e.showOKMessage("error","Investment amount must be "+o("number")(k,0)+n.currency+" or higher","OK");return}}else{e.showOKMessage("error","Fill all portfolio details","OK");return}w(enumEfCalculationType.BestTP,[])};n.$watch("customType",function(n,t){n!=t&&n=="2"&&it(1)},!0);w=function(t,i){n.newPort.benchMarks=n.newPort.benchMarks.map(function(n){return n&&n.id});n.newPort.FullbenchMarks=o("filter")(n.benchMarks,nt,!0);n.$parent.saveNewBacktestingParams(n.newPort);var r={StartDate:n.newPort.StartDate,EndDate:n.newPort.EndDate,PortfolioCommand:{Name:n.newPort.Name,Securities:i,Equity:n.newPort.Equity,Risk:0,Exchanges:n.newPort.Exchanges,CalcType:t},BenchMarkID:n.newPort.benchMarks};n.createNewPortfolio=!0;n.$parent.createPortfolio(r,!0)};nt=function(t){return t?n.newPort.benchMarks.indexOf(t.id)>=0:!1};n.isValidPortfolioName=function(){return n.newPort&&n.newPort.Name&&n.newPort.Name.length>15?(e.showOKMessage("error","Invalid portfolio name – Please enter a name up to 15 characters","OK"),!1):n.newPort.Name.indexOf("/")>-1?(e.showOKMessage("error",'Invalid portfolio name – "/" is not allowed in portfolio name',"OK"),!1):!0};n.search=function(){clearTimeout(b);b=setTimeout(function(){n.tableParams.page(1);n.tableParams.reload()},500)};n.addOrRemoveToSectorList=function(t){if(t)if(t.select){if(n.selectSecurityNum==n.stocksCount){e.showOKMessage("message","You have reach the max securities you can select","OK");t.select=!1;return}n.selectSecurityNum=n.selectSecurityNum+1;n.selectedSecurities.push({select:!0,idSecurity:t.idSecurity})}else{n.selectSecurityNum=n.selectSecurityNum-1;for(var i=0;i<n.selectedSecurities.length;i++)if(n.selectedSecurities[i].idSecurity==t.idSecurity){n.selectedSecurities.splice(i,1);break}}};n.setRiskFilter=function(t){t=="None"?(n.isRiskFilter=!1,n.riskFilter=null):(n.isRiskFilter=!0,n.riskFilter=t);n.searchParams.maxRiskLevel=ft(t);a();v()};n.exchangesClosed=function(){a();var t=n.exchangesFilter.slice();tt(d,t,"id")||v();d=t};n.sectorsClosed=function(){a();var t=n.sectors.slice();tt(g,t,"id")||v();g=t};n.setNewPortRiskType=function(t){n.newPort.PreferedRisk||(n.newPort.PreferedRisk={});n.customType!=2?(n.RiskType=t,n.newPort.PreferedRisk.RiskType=ut(t)):(n.RiskType=null,n.newPort.PreferedRisk.RiskType=null)};n.applyFilter=function(t){n.sectors=t.sectors.slice();n.exchangesFilter=t.exchanges.slice();n.searchParams.maxRiskLevel=t.riskLevel;v()};n.$on("$destroy",function(){for(var t in n)t.indexOf("$")==1&&(n[t]=null)});var rt=function(){var t,i;return n.$parent.isInProgress?(e.showOKMessage("message","The system is already building a portfolio, please wait","OK"),!1):n.portForm.$invalid?(e.showOKMessage("message","Please fill in all required fields.","OK"),!1):n.newPort.Name&&!n.isValidPortfolioName()?!1:(t=864e5,(n.newPort.EndDate.getTime()-n.newPort.StartDate.getTime())/t<30)?(e.showOKMessage("message","Must select a minimum of 90 days","OK"),!1):new Date(n.newPort.EndDate)>new Date?(e.showOKMessage("message","Can't select future date","OK"),!1):(i=new Date(n.newPort.StartDate.getFullYear()+2,n.newPort.StartDate.getMonth(),n.newPort.StartDate.getUTCDate()),i<n.newPort.EndDate)?(e.showOKMessage("message","Date range maximum is 2 years","OK"),!1):!n.customType||n.customType==""?(e.showOKMessage("message","Please select a Building Process.","OK"),!1):new Date(l.Licence.ExpiryDate)<new Date?(e.showOKMessage("message","Your license has expired. You can no longer build new portfolios. Please contact us at info@gocherries.com to renew your license.","OK"),!1):l.Licence.Service.Iportfolios<=n.$parent.getPortfolioList().length?(e.showOKMessage("message","You've exceeded the number of portfolios you can create. Please delete any unwanted portfolios","OK"),!1):!0},ut=function(n){switch(n){case 0:return 0;case 1:return 9/100;case 2:return 14/100;case 3:return 25/100;case 4:return 40/100;case 5:return 1}},lt=function(n){switch(n){case 0:return"TP";case 1:return"Solid";case 2:return"Low";case 3:return"Moderate";case 4:return"High";case 5:return"Very High"}},at=function(t){var i=l.Currency.CurrencyId!="9001"?t.avgYield:t.avgYieldNIS;return i=o("number")(i*100,2),i*1>=n.returnValueFilter*1},ft=function(){switch(n.riskFilter){case"Solid":return 9;case"Low":return 14;case"Moderate":return 25;case"High":return 40;case"Very High":return 100;default:return 0}},it=function(t){t=t==null?1:t;n.tableParams=new r({page:t,count:n.searchParams.pageSize},{total:n.data.length,counts:[],getData:function(t,i){n.searchParams.pageNumber=n.tableParams.page();n.searchParams.pageSize=n.tableParams.count();n.searchParams.exchangesPackagees=ht();n.searchParams.sectors=ct();n.searchParams.hideDisqualified=!n.showDisqualified;u.getAllSecurities(n.searchParams).$promise.then(function(r){h(function(){var u,f;if(!r.Securities||r.Securities.length==0){n.data=[];e.showOKMessage("error","There are no securities available","OK");return}if(n.data=r.Securities,n.selectedSecurities.length>0)for(u=0;u<n.data.length;u++)f=n.selectedSecurities.filter(function(t){return t.idSecurity==n.data[u].idSecurity}),f.length>0&&(n.data[u].select=!0);i.total(r.NumOfRecords);n.currenPageCount=i.page()*i.count()<r.NumOfRecords?i.count():r.NumOfRecords-(i.page()-1)*i.count();t.resolve(n.data)},500)},function(){})}})},et=function(){var i=n.$parent.getLookupValues(),t;for(i!=null&&(n.sectorsOptions=i.Categories.Sector),t=0;t<n.sectorsOptions.length;t++)n.sectorsOptions[t].label=n.sectorsOptions[t].strValue;for(t=0;t<n.stockMarket.length;t++)n.stockMarket[t].label=n.stockMarket[t].HebName},ot=function(){u.getBenchmarkSecurities().$promise.then(function(t){n.benchMarks=[];for(var i=0;i<t.Securities.length;i++)n.benchMarks.push({id:t.Securities[i].ID,label:t.Securities[i].Name})})},st=function(){n.$parent.selectMenu=3;l=n.$parent.getUser();n.stocksCount=l.Licence.Stocks.length*250;n.avgYield="AvgYield";n.stockMarketSettings={showCheckAll:!0,showUncheckAll:!0,idProp:"id",sellectAllDefault:!1,buttonDefaultText:"select",buttonClasses:"btn btn-default drop-btn",scrollable:!0,scrollableHeight:190};n.benchMarkSettings={showCheckAll:!1,showUncheckAll:!1,idProp:"id",sellectAllDefault:!1,buttonDefaultText:"None",buttonClasses:"btn btn-default drop-btn",scrollable:!0,scrollableHeight:190,selectionLimit:3};n.benchMarkTexts={buttonDefaultText:"None"};n.sectorsSettings={showCheckAll:!0,showUncheckAll:!0,idProp:"iIndex",sellectAllDefault:!1,buttonDefaultText:"select",buttonClasses:"btn btn-default drop-btn",scrollable:!0,scrollableHeight:190};n.columns=[{name:"strName",colwidth:3,paddingLeft:"3px"},{name:"strSymbol",colwidth:2,paddingLeft:"10px"},{name:"marketName",colwidth:1,paddingLeft:"14px"},{name:"sectorName",colwidth:2,paddingLeft:"16px"},{name:n.avgYield,isPercentage:!0,colwidth:2,paddingLeft:"22px"},{name:"rank",moreInfo:!0,isNumber:!0,colwidth:2,paddingLeft:"22px"},];n.mobileColumns={title:{primary:"strName",secondary:"strSymbol"},properties:[{name:"sectorName",title:"Sector"},{name:"marketName",title:"Exchange"},{name:"rank",title:"Rank",isNumber:!0}]};n.stockMarket=l.Licence.Stocks;et();ot();n.filterDataSource.exchanges=n.stockMarket.map(function(n){return{id:n.id,label:n.HebName}});n.filterDataSource.sectors=n.sectorsOptions.map(function(n){return{id:n.iIndex,label:n.strValue}});a();n.customType==2&&it(1)};st()}]);app.directive("login",["$location","$modal","loginSvc","utilitiesSvc",function(n,t,i,r){function u(n){return n.addClass("login"),f}function f(t){t.onKeyPress=function(n){n.keyCode==13&&t.enterApplicant()};t.enterApplicant=function(){i.get(t.user).then(function(i){if(i.User==null){r.showOKMessage(messagesType.error,"There is no user",buttonsType.OK,!0,!0);return}if(i.Messages.length>0&&r.showOKMessage(messagesType.error,i.Messages[0].Text,buttonsType.OK,!0,!0),t.$parent.$parent.saveUser(i.User),t.$parent.$parent.saveAccountData(i.User),t.$parent.$parent.saveFullUser(i),i.User.isTemporary){t.$parent.$parent.saveUserDetails({UserName:i.User.Username});n.path("newPassword/");return}n.path("portfolios/");new Date(i.User.Licence.ExpiryDate)<new Date&&r.showOKMessage(messagesType.error,"Your license has expired. You can no longer build new portfolios. Please contact us at info@gocherries.com to renew your license.",buttonsType.OK,!0,!0)},function(n){console.log(n)})};t.forgetPassword=function(){n.path("forgetPassword/")};t.logout=function(){i.logoff().$promise.then(function(){sessionStorage.clear()})};var u=function(){t.user={UserName:"",Password:""}};u()}return{restrict:"AE",templateUrl:"scripts/app/partials/login.min.html",scope:{},compile:u}}]);app.directive("portfolio",["$location","$modal","utilitiesSvc","portfolioSvc",function(n,t,i,r){return{restrict:"E",templateUrl:"scripts/app/partials/portfolio.min.html",scope:{model:"=",refreshAll:"&"},compile:function(t){return t.addClass("portfolio"),function(t){t.openPortfolio=function(){n.path("/portfolios/"+t.model.ID)};t.deletePortfolio=function(n){n.stopPropagation();i.showYesNoMessage("message","This portfolio will be deleted, continue?","yes","no").then(function(){r.deletePortfolio(t.model.ID).$promise.then(u,f)})};t.toggleSectors=function(n){n.stopPropagation();t.showAll=!t.showAll};var u=function(){i.showOKMessage("message","Portfolio: "+t.model.Name+" deleted.","OK");t.refreshAll({port:t.model})},f=function(){i.showOKMessage("error","failed to delete portfolio: "+t.model.Name,"OK")},e=function(){var n=t.model.CurrentStDev*100,i;switch(!0){case n>0&&n<=9:i="Solid";break;case n>9&&n<=14:i="Low";break;case n>14&&n<=25:i="Moderate";break;case n>25&&n<=40:i="High";break;case n>40&&n<=100:i="Very High"}t.riskColor=t.riskColors[i];t.riskColor||(t.riskColor="#ffffff");t.getCurrency=function(n){return t.$parent.getLookupValues().Currencies.filter(function(t){return t.CurrencyId==n})[0].CurrencySign}},o=function(){user=t.$parent.getUser();t.currency=user.Currency.CurrencySign;t.riskColors=riskColors;e()};o()}}}}]);app.directive("backtesting",["$location","$modal","utilitiesSvc","backtestingSvc",function(n,t,i,r){return{restrict:"E",templateUrl:"scripts/app/partials/backtesting.html",scope:{model:"=",refreshAll:"&"},compile:function(t){return t.addClass("backtesting"),function(t){t.$on("$destroy",function(){for(var n in t)n.indexOf("$")==1&&(t[n]=null)});t.openBacktesting=function(){r.getbacktesingPortfoliesById(t.model.Details.ID).$promise.then(function(i){var e=i,u=[],r,f;if(i.benchMarkResult)for(r=0;r<i.benchMarkResult.length;r++)i.benchMarkResult[r].Item1=i.benchMarkResult[r].m_Item1,i.benchMarkResult[r].Item2=i.benchMarkResult[r].m_Item2,i.benchMarkResult[r].Item1.ID!="0000"&&u.push({id:i.benchMarkResult[r].Item1.ID,label:i.benchMarkResult[r].Item1.Name});f={Equity:i.Equity,FullbenchMarks:u,Name:t.model.Details.Name,StartDate:new Date(t.model.StartDate),EndDate:new Date(t.model.EndDate)};i.Equity=t.model.Details.Equity;t.$parent.saveBacktestingParams(f);t.$parent.setBacktestingDetails(i);n.path("/backtesting")})};t.deleteBacktesting=function(n){n.stopPropagation();i.showYesNoMessage("message","This backtesting will be deleted, continue?","yes","no").then(function(){r.deleteBacktesting(t.model.Details.ID).$promise.then(u,f)})};t.toggleSectors=function(n){n.stopPropagation();t.showAll=!t.showAll};var u=function(){i.showOKMessage("message","Backtesting: "+t.model.Details.Name+" deleted.","OK");t.refreshAll({backtest:t.model})},f=function(){i.showOKMessage("error","failed to delete backtesting: "+t.model.Details.Name,"OK")},e=function(){var n=t.model.Details.CurrentStDev*100,i;switch(!0){case n>0&&n<=9:i="Solid";break;case n>9&&n<=14:i="Low";break;case n>14&&n<=25:i="Moderate";break;case n>25&&n<=40:i="High";break;case n>40&&n<=100:i="Very High"}t.riskColor=t.riskColors[i];t.riskColor||(t.riskColor="#ffffff");t.getCurrency=function(n){return t.$parent.getLookupValues().Currencies.filter(function(t){return t.CurrencyId==n})[0].CurrencySign}},o=function(){user=t.$parent.getUser();t.currency=user.Currency.CurrencySign;t.riskColors=riskColors;e()};o()}}}}]);app.directive("cstHeader",["$modal","utilitiesSvc","$location","$window","$location","loginSvc",function(n,t,i,r,i,u){return{restrict:"EA",replace:!0,templateUrl:"Scripts/app/partials/header.html",link:function(n){n.selectMenu=0;n.saveAccountData=function(i){n.marketStock=i.Licence.Stocks;for(var r=0;r<n.marketStock.length;r++)n.marketStock[r].Name=n.marketStock[r].Name.substring(0,n.marketStock[r].Name.indexOf("Stock E"));n.expiryDate=i.Licence.ExpiryDate;n.daysLeft=t(new Date(n.expiryDate),new Date);n.licenseType=i.Licence.Service.StrServiceType};n.pageClick=function(t){t.target.id!="accountDiv"&&(n.showAccount=!1)};n.back=function(){r.history.back()};n.logout=function(){u.logoff().$promise.then(function(){n.clearSession();n.isDataReady=!1;n.isInProgress=!1;n.wantToLogout=!0;i.path("/")})};n.showOrhideAccount=function(){n.showAccount=!n.showAccount};n.isHomePage=function(){return i.$$path=="/portfolios"};n.toggleMobileMenu=function(){n.isMobileOpen=!n.isMobileOpen};n.updateDetail=function(t){n.showAccount=!1;i.path(t)};var t=function(n,t){var i=n.getTime(),r=t.getTime(),u=i-r;return Math.round(u/864e5)},f=function(){var t=n.getUser();t&&n.saveAccountData(t)};f()}}}]);app.directive("loginHeader",function(){return{restrict:"EA",replace:!0,templateUrl:"Scripts/app/partials/loginHeader.min.html"}});utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","errorHandler","utilitiesSvc","$location",function(n,t,i,r,u,f){function o(n){n.removeClass("hide");n.addClass("show")}function e(n){n.removeClass("show");n.addClass("hide")}return{restrict:"EA",templateUrl:"scripts/app/partials/loader.min.html",link:function(s,h){var c=[];i.request=function(n){return c.push({}),c.length==1&&o(h),n||t.when(n)};i.response=function(i){return(c.pop(),c.length===0&&n(function(){c.length===0&&e(h)},500),i&&i.data&&i.data.Messages&&r.checkErrors(i.data))?t.reject(i.data.Messages):i||t.when(i)};i.responseError=function(i){return(c.pop(),i&&i.data&&i.data.ModelState&&r.checkErrors(i.data))?t.reject(i.data.ModelState):i.status==401&&sessionStorage.getItem("user")!=null?(u.showOKMessage("error","Your session has expired, please relogin","OK"),sessionStorage.removeItem("user"),sessionStorage.removeItem("userDetails"),f.path("/"),t.reject(null)):(c.length===0&&n(function(){c.length===0&&e(h)},500),t.reject(i))}}}}]);utilities.factory("httpInterceptor",function(){return{}});app.directive("numberOnly",["$timeout","$compile","$filter",function(n,t,i){return{require:"ngModel",scope:{negativeNumber:"=?",isNumberFormat:"=?",numberLength:"=?",limitDecimal:"=?"},link:function(n,t,r,u){u.$parsers.push(function(t){var r,f;return t==""?"":(r=t.toString(),r=n.negativeNumber==!0?r.replace(/[^-?0-9,\.]/g,""):n.isNumberFormat==!0?n.limitDecimal==!0?r.replace(/[^0-9,]/g,""):r.replace(/[^0-9,\.]/g,""):r.replace(/[^0-9]/g,""),n.numberLength&&r.replace(/[^0-9]/g,"").length>n.numberLength&&(r=r.replace(/[^0-9]/g,""),r=r.substring(0,n.numberLength)),r!=t&&(u.$setViewValue(r),u.$render()),n.isNumberFormat==!0&&(f=r.replace(/,/g,""),t[t.length-1]!="-"&&t[t.length-1]!="."&&i("number")(f)!=r&&(f!=""?u.$setViewValue(i("number")(f,0)):u.$setViewValue(f),u.$render())),r.replace(/,/g,""))});u.$formatters.push(function(t){return n.isNumberFormat==!0?i("number")(t):t})}}}]);app.directive("security",["$location","$modal","utilitiesSvc","generalSvc","$filter","priceSvc","$rootScope",function(n,t,i,r,u,f,e){function o(n){return n.addClass("security"),s}function s(n){var t;n.model||(n.model={});n.isNIS=n.currency!="9001";n.model.AvgYield=n.isNIS?n.model.AvgYieldNIS:n.model.AvgYield;n.riskColors=riskColors;n.changeModelSelect=function(){n.selectModel&&n.selectModel({model:n.model})};n.showInfo=function(){if(n.showPrices){n.showPrices=!1;return}if(n.lineOptions!=null){n.showPrices=!0;return}f.getPrices({secId:n.model.idSecurity,currency:n.currency}).$promise.then(function(r){t=r.Rates;i(r.Rates);n.showPrices=!0;setTimeout(function(){var t=document.getElementById("sec").offsetWidth;e.$broadcast("initChartLineScroll",n.model.idSecurity,t)},100)})};n.updatechartSize=function(){};n.getRiskColor=function(){if(n.model[n.riskColorField]){var t=u("number")(n.model[n.riskColorField]*100,2)*1;switch(!0){case t>=0&&t<=9:return n.riskColors.Solid;case t>9&&t<=14:return n.riskColors.Low;case t>14&&t<=25:return n.riskColors.Moderate;case t>25&&t<=40:return n.riskColors.High;case t>40&&t<=100:return n.riskColors["Very High"]}}return"#ffffff"};e.$on("resizeWindow",function(t,i){if((n.rowHeight==50||n.rowHeight==60)&&(n.rowHeight=i<=1366?60:50),n.showPrices){var r=document.getElementById("sec").offsetWidth;e.$broadcast("initChartLineScroll",n.model.idSecurity,r)}});String.format=function(n){var t=arguments;return n.replace(/{[0-9]}/g,function(n){t[parseInt(n.replace(/[{}]/g,""))+1]})};var i=function(i){var r,f,e,o;for(n.lineLabels=[],n.lineLabelTags=[],n.lineData=[],r=0;r<i.length;r++)f=i[r].Date.substring(0,i[r].Date.indexOf("T")).split("-"),e=new Date(f[0],f[1]-1,f[2]),r>0&&(f=i[r-1].Date.substring(0,i[r-1].Date.indexOf("T")).split("-"),o=new Date(f[0],f[1]-1,f[2])),n.lineLabels.push(u("date")(i[r].Date,"MM/dd/yyyy")),n.lineLabelTags.push(i[r].Label),n.lineData.push(parseInt(u("number")(i[r].RateVal,2)));n.startDate=u("date")(i[0].Date,"MM/dd/yyyy");n.endDate=u("date")(i[i.length-1].Date,"MM/dd/yyyy");n.lineOptions={showTooltips:!0,notRotateLabel:!0,tooltipTemplate:function(n){if(n.index!=null&&n.index>=0){var i=t[n.index];return i.Tooltip}},fillColor:"#ADC0DA",strokeColor:"#ADC0DA",pointColor:"#FFFFFF",barValueSpacing:1,barDatasetSpacing:10,scaleShowLabels:!0,scaleBeginAtZero:!0}},o=function(){n.ChartLinePrices={labels:labels,lineLabelTags:lineLabelTags,series:["Solid: 0%-9%","Low: 9%-14%","Moderate: 14%-25%","Hight:25%-40%"," very Hight:40%-100%"],data:allData,options:{scaleBeginAtZero:!1,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!1,scaleShowVerticalLines:!1,scaleShowLabels:!0,barShowStroke:!0,barStrokeWidth:5,barValueSpacing:15,barDatasetSpacing:3,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"><\/span><%if(datasets[i].label){%><%=datasets[i].label%><%}%><\/li><%}%><\/ul>',responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{ticks:{display:!1}}]}},colours:[{fillColor:"#ADC0DA",strokeColor:"#ADC0DA",pointColor:"#FFFFFF"},]}},r=function(){n.showPrices=!1;n.rowHeight=45;n.is_iPad=navigator.userAgent.match(/iPad/i)!=null};r();n.$on("$destroy",function(){for(var t in n)t.indexOf("$")==1&&(n[t]=null)})}return{restrict:"E",templateUrl:"scripts/app/partials/security.html",scope:{model:"=",index:"=",columns:"=",mobileColumns:"=",riskColorField:"=",disableMode:"=",canSelect:"=",chartWidth:"=",isFull:"=",selectModel:"&",currency:"=",isLast:"="},compile:o}}]);app.directive("chartLine",["$modal","utilitiesSvc","$location","$window","$rootScope",function(n,t,i,r,u){return{restrict:"EA",replace:!0,templateUrl:"Scripts/app/partials/chartLine.min.html",scope:{name:"=",labels:"=",allData:"=",options:"=",chartWidth:"=",showTooltip:"="},link:function(n){var t,i;u.$on("initChartLine",function(t,r){n.name==r&&i()});n.$on("$destroy",function(){t!=null&&t.destroy();for(var i in n)i.indexOf("$")==1&&(n[i]=null);t=null});i=function(){var r,u;n.options&&!n.flag&&(n.flag=!0,r=document.getElementById(n.name).getContext("2d"),r.canvas.width=n.chartWidth?n.chartWidth:1280,r.canvas.height=n.chartHeight?n.chartHeight:300,u={labels:n.labels,datasets:[{label:n.labels,fillColor:n.options.fillColor,strokeColor:n.options.strokeColor,pointColor:n.options.pointColor,barStrokeWidth:n.options.barStrokeWidth,barValueSpacing:n.options.barValueSpacing,barDatasetSpacing:n.options.barValueSpacing,data:n.allData.filter(function(n){return n.sectorName!=""})}]},t=new Chart(r).Line(u,{showTooltips:n.showTooltip}),i())}}}}]);app.directive("chartLineScroll",["$modal","utilitiesSvc","$location","$window","$rootScope",function(n,t,i,r,u){return{restrict:"EA",replace:!0,templateUrl:"Scripts/app/partials/chartLineScroll.min.html",scope:{name:"=",labels:"=",allData:"=",options:"=",chartWidth:"=",showTooltip:"=",labelTags:"=",selectPointEvent:"&"},link:function(n,t){function s(i){var o;if(i.scale!=undefined){var s=i.chart.ctx.canvas,r=i.scale.xScalePaddingLeft-4,u=i.scale.height-16,f=document.getElementById(n.name+"Axis").getContext("2d"),e=t.find(".chartWrapper__axis");e.width(r);e.height(u);f.canvas.width=r;f.canvas.height=u;o=i.chart.ctx.getImageData(0,0,r,u);f.putImageData(o,0,0)}}function r(){i.font='16px "Gotham Book",sans-serif';i.fontWeight="bold";i.fillStyle="#000";i.textAlign="center";$(f.datasets).each(function(n,t){$(t.points).each(function(n,r){var u=t.labelTags[n];u&&(r.y>230?(i.fillText(u,r.x,r.y-45),i.beginPath(),i.moveTo(r.x,r.y-30),i.lineTo(r.x,r.y-2)):(i.fillText(u,r.x,r.y+45),i.beginPath(),i.moveTo(r.x,r.y+30),i.lineTo(r.x,r.y+2)),i.strokeStyle="#000000",i.stroke())})})}var f,i,o,e;n.maxChartWidth;n.$on("$destroy",function(){f!=null&&f.destroy();for(var t in n)t.indexOf("$")==1&&(n[t]=null);f=null});u.$on("initChartLineScroll",function(t,i,r){n.name==i&&(n.chartWidth||n.warpperWidth==r-50||(n.flag=!1,n.warpperWidth=r-50,n.maxChartWidth=window.innerWidth-200,e(),angular.element("#chartlinecanvas").trigger("click")))});e=function(){var u,e,h,t;n.options&&!n.flag&&document.getElementById(n.name)&&(n.flag=!0,o=n.allData,i=document.getElementById(n.name).getContext("2d"),u=n.allData&&n.allData.length*100>n.maxChartWidth?n.allData.length*100:n.maxChartWidth,e=navigator.userAgent.match(/iPad/i)!=null,i.canvas.width=u>11e3&&e?11e3:u,i.canvas.height=n.chartHeight?n.chartHeight:300,h={labels:n.labels,labelTags:n.labelTags,datasets:[{label:n.labels,labelTags:n.labelTags,fillColor:n.options.fillColor,strokeColor:n.options.strokeColor,pointColor:n.options.pointColor,data:n.allData.filter(function(n){return n.sectorName!=""})}]},n.options.onAnimationProgress=function(){var n=this;setTimeout(function(){r(n)},1)},n.options.onAnimationComplete=function(){var n=this;s(n);setTimeout(function(){r(n)},1)},t=document.getElementById(n.name),t.onmousemove=function(){var n=this;setTimeout(function(){r(n)},1)},t.onmouseover=function(){var n=this;setTimeout(function(){r(n)},1)},t.onmouseenter=function(){var n=this;setTimeout(function(){r(n)},1)},t.onmouseout=function(){var n=this;setTimeout(function(){r(n)},1)},f=new Chart(i).Line(h,n.options))};e()}}}]);app.directive("chartPie",["$modal","utilitiesSvc","$location","$window","$rootScope",function(n,t,i,r,u){return{restrict:"EA",replace:!0,templateUrl:"Scripts/app/partials/chartPie.min.html",scope:{name:"=",labels:"=",data:"=",options:"=",chartWidth:"=",chartHeight:"="},link:function(n){var s,i,f,e,r,t;n.$on("$destroy",function(){i!=null&&i.destroy();for(var t in n)t.indexOf("$")==1&&(n[t]=null);i=null});u.$on("initChartPie",function(t,i){n.name==i&&c()});n.seriesClick=function(t){for(var i=0;i<n.options.series.length;i++)n.options.series[i].select=!1;n.options.series[t].select=!0;o()};var h=function(t){var u,f,r;if(i){for(u=i.getSegmentsAtEvent(t),f=i.segments.indexOf(u[0]),r=0;r<n.options.series.length;r++)n.options.series[r].select=!1;n.options.series[f].select=!0;return}},c=function(){i!=null&&i.destroy();var u=document.getElementById("container-"+n.name);t=document.getElementById(n.name);t&&$(t).remove();t=document.createElement("canvas");t.id=n.name;t.style.marginLeft="-20px";u.appendChild(t);r=t.getContext("2d");r.clearRect(0,0,t.width,t.height);r.canvas.width=n.chartWidth?n.chartWidth:350;r.canvas.height=n.chartHeight?n.chartHeight:250;f=t.width/2;e=t.height/2;s=v(n.data);t.onclick=h;n.options.showTooltips=!0;n.options.tooltipTemplate="<%if (label){%><%=label %>: <%}%><%= Math.floor(value) + ' %' %>";n.options.onAnimationProgress=o;i=new Chart(r).Pie(n.data,n.options)},l=function(){return 8},o=function(){for(var t=0;t<i.segments.length;t++)a(i.segments[t],n.options.series[t].select)},a=function(n,t){var o=i.outerRadius,u;r.fillStyle="black";u=l(n.value,t);r.font=u+"px Verdana";var c=Math.floor(n.value),s=n.startAngle,a=n.endAngle,h=s+(a-s)/2,v=o/.98*Math.cos(h)+f,y=o/.98*Math.sin(h)+e,p=r.measureText(c).width/2,w=u/2},v=function(n){var i,t;if(!n)return 0;for(i=0,t=0;t<n.length;t++)i+=n[t].value;return i}}}}]);app.directive("lineScattertest",["$modal","utilitiesSvc","$location","$window","$rootScope","underscore",function(n,t,i,r,u,f){return{restrict:"EA",replace:!0,templateUrl:"Scripts/app/partials/lineScattertest.min.html",scope:{labels:"=",allData:"=",options:"=",chartWidth:"=",multiLines:"=",selectPointEvent:"&"},link:function(n,t){function a(t){c.height="450";c.width=n.chartWidth?n.chartWidth:n.warpperWidth;var i=c.getContext("2d");i.strokeStyle="#ff0000";i.lineWidth=2;i.beginPath();i.moveTo(t,0);i.lineTo(t,e.height);i.stroke()}function o(t){i.font='16px "Gotham Book",sans-serif';i.fontWeight="bold";i.fillStyle="#000";i.textAlign="center";$(r.datasets).each(function(u,f){$(f.points).each(function(f,e){var c,o,s;e.tagLabel!==undefined&&(e.tagLabel!="overPoint"?(e.tagLabel&&e.tagLabel.indexOf("Opt")>-1&&n.isInit&&(n.options.ySelect=e.value,n.options.xSelect=Number(e.label),n.selectPointEvent({index:f,indexline:u}),n.isInit=!1,r.destroy(),h()),o=e.x,n.options.tagWithPath&&(i.beginPath(),c=0,e.y>60?(i.fillText(e.tagLabel,o,n.options.leftTag?e.y+20:e.y-50),i.moveTo(o,e.y-40),i.lineTo(o,e.y-5)):(i.fillText(e.tagLabel,o,n.options.leftTag?e.y-20:e.y+50),i.moveTo(o,e.y+40),i.lineTo(o,e.y+5)),i.strokeStyle="#000000",i.stroke())):t&&(i.beginPath(),o=e.x,s=e.y,i.moveTo(o,e.y),i.lineTo(o,e.y+(i.canvas.height-e.y-30)),i.strokeStyle="#000000",i.stroke(),i.beginPath(),i.moveTo(o,e.y),i.lineTo(45,s),i.strokeStyle="#000000",i.stroke()))})})}var r,i,e,c=t.find(".bg-canvas")[0],h;n.flag;n.isInit=!0;n.$on("$destroy",function(){r!=null&&r.destroy();for(var t in n)t.indexOf("$")==1&&(n[t]=null);r=null});u.$on("initLineScattertest",function(t,i){n.warpperWidth=window.innerWidth-250;v(i)});u.$on("resizeWindow",function(){if(n.warpperWidth!=window.innerWidth-250){if(n.warpperWidth=window.innerWidth-250,!r)return;r.destroy();h();var t=c.width-68,i=(n.chartWidth?n.chartWidth:n.warpperWidth)-68;s!=null&&(s=(s-40)*(i/t)+40,a(s))}});var v=function(t){n.flag||(n.flag=!0,h(t))},l=null,s=null,y=function(t){var i,f,u;if(r)for(i=r.getPointsAtEvent(t),f=r.datasets[0].points.indexOf(i[0]),n.options.selectionLine&&i.length>0&&(l=i[0],s=l.x,a(s)),u=0;u<r.datasets.length;u++)if(r.datasets[u].points.indexOf(i[0])>-1){n.options.ySelect=i[0].value;n.options.xSelect=Number(i[0].label);n.selectPointEvent({index:r.datasets[u].points.indexOf(i[0]),indexline:u});r.destroy();h();return}};h=function(t){function s(n){var t=r.getPointsAtEvent(n);t&&t.length>0?o(!0):o()}r!=null&&r.destroy();var u=document.getElementById("container-lsChart");e=document.getElementById("lsChart");e&&$(e).remove();e=document.createElement("canvas");e.id="lsChart";e.height="450";angular.element(e).css("position","relative");u.appendChild(e);i=e.getContext("2d");i.canvas.width=n.chartWidth?n.chartWidth:n.warpperWidth;n.options.onAnimationProgress=function(){setTimeout(function(){o()},0)};n.options.onAnimationComplete=function(){setTimeout(function(){o()},0)};e.onclick=y;e.onmousemove=f.throttle(s,100,{leading:!1});e.onmouseover=function(){setTimeout(function(){o(!0)},0)};e.onmouseenter=function(){setTimeout(function(){o(!0)},0)};e.onmouseout=function(){setTimeout(function(){o()},0)};r=new Chart(i).Scatter(n.allData,n.options);setTimeout(function(){t&&(r.draw(),angular.element("#chartScatchercanvas").trigger("click"))},100)};u.$on("updateScetcherTagsAndRedPoint",function(){n.isInit=!0;n.flag=!1})}}}]);app.directive("resize",["$window","$rootScope",function(n,t){return{restrict:"A",link:function(i){var r=angular.element(n);i.getWindowDimensions=function(){return{h:r.height(),w:r.width()}};i.$watch(i.getWindowDimensions,function(n){i.windowHeight=n.h;i.windowWidth=n.w;setTimeout(function(){t.$broadcast("resizeWindow",n.w)},100)},!0);r.bind("resize",function(){i.$apply()})}}}]);app.directive("paypalPayment",["$rootScope","utilitiesSvc",function(n,t){return{restrict:"E",templateUrl:"scripts/app/partials/paypalPayment.min.html",scope:{model:"=",disable:"=",total:"=",currency:"="},link:function(i){var r=function(){paypal.Button.render({env:"sandbox",client:{sandbox:"AZDxjDScFpQtjWTOUtWKbyN_bDt4OgqaF4eYXlewfBP4-8aqX3PiV8e1GWU6liB2CUXlkA59kJXE7M6R",production:"Aco85QiB9jk8Q3GdsidqKVCXuPAAVbnqm0agscHCL2-K2Lu2L6MxDU2AwTZa-ALMn_N0z-s2MXKJBxqJ"},payment:function(){return paypal.rest.payment.create(this.props.env,this.props.client,{transactions:[{amount:{total:i.total,currency:i.currency}}]})},onAuthorize:function(i,r){return r.payment.execute().then(function(t){n.$broadcast("paypalPaymentComplited",t)},function(){t.showOKMessage("error","Payment failed","OK")})}},"#paypal-button-container")};r()}}}]);app.directive("cstNumber",["$compile","utilitiesSvc",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){function e(n,t){var i=!0;return r[t]&&n!=""&&!isNaN(n)&&(i=t=="max"?n<=parseFloat(r[t]):n>=parseFloat(r[t])),u.$setValidity(t+"Number",i),i}function o(n){return n&&n.toString().indexOf(".")>-1&&n.toString().indexOf(".")<n.toString().length-2&&(n=parseFloat(n).toFixed(2)),n}var f,s,h;setElementNameAndModel(t,u,i);f=i.closest("form")[0].name+"."+i[0].name;s=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.maxNumber","class":"error-message"}).text("מספר גדול מ "+i.attr("max"));i.parent().append(s);n(s)(t);h=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.minNumber","class":"error-message"}).text("מספר קטן מ "+i.attr("min"));i.parent().append(h);n(h)(t);u.errorMessage=u.errorMessage||{};u.errorMessage.minNumber=r.label+": מספר קטן מ "+r.min;u.$parsers.unshift(function(n){var t=e(n,"min");return n=o(n),t?n:undefined});u.$formatters.unshift(function(n){return e(n,"min"),o(n)});u.errorMessage=u.errorMessage||{};u.errorMessage.maxNumber=r.label+": מספר גדול מ "+r.max;u.$parsers.unshift(function(n){var t=e(n,"max");return n=o(n),t?n:undefined});u.$formatters.unshift(function(n){return e(n,"max"),o(n)})},post:function(n,t,i,r){t.bind("keypress",function(){for(var i=this.value.replace(/\d+\.?\d{0,1}/,""),t=this.value.length-1;t>-1;t--)if(i.indexOf(this.value.charAt(t))>-1){this.value=this.value.slice(0,t)+this.value.slice(t+1);break}r.$setViewValue(this.value);r.$render();n.$apply()})}}}}}]);app.directive("cstZehut",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){setElementNameAndModel(t,u,i);var f=i.closest("form")[0].name+"."+i[0].name,e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.zehut","class":"error-message"}).text("ספרת ביקורת שגויה");i.parent().append(e);n(e)(t);u.errorMessage=u.errorMessage||{};u.errorMessage.zehut=r.label+": ספרת ביקורת שגויה "},post:function(n,t,i,r){t.bind("keyup",function(){var t=this.value.split("").filter(function(n){return!isNaN(n)&&n!=" "}).join("");r.$viewValue=t;r.$render();n.$apply()});t.on("blur",function(){var t=this.value,f,u,i;if(t!=""){for(t=t.padLeft(9),f=0,i=0;i<t.length;i++)u=Number(t.toString().charAt(i))*(i%2+1),f+=u>9?u-9:u;r.$setValidity("zehut",f%10==0)}else r.$setValidity("zehut",!0);r.$setViewValue(t);r.$render();n.$apply()})}}}}}]);app.directive("cstBirthDateYear",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){setElementNameAndModel(t,u,i);var f=i.closest("form")[0].name+"."+i[0].name,e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.birthDateYear","class":"error-message"}).text(r.labelTxt);i.parent().append(e);n(e)(t)},post:function(n,t,i,r){r.errorMessage=r.errorMessage||{};r.errorMessage.birthDateYear=i.label+i.labelMin;var u=function(n){var u=i.minYear,f=i.maxYear,t;return!n||n==""?(r.$setValidity("birthDateYear",!0),n):(t=/^\d{4}$/.test(n),r.$setValidity("birthDateYear",t&&(n>=i.minYear||n<=i.maxYear)),n)};r.$parsers.unshift(u);r.$formatters.push(u);i.$observe("dateMinModel",function(){return u(r.$viewValue)});i.$observe("dateMaxModel",function(){return u(r.$viewValue)})}}}}}]);app.directive("cstHebrewText",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){var f,e,o;setElementNameAndModel(t,u,i);f=i.closest("form")[0].name+"."+i[0].name;t.textLength==null&&(t.textLength=[]);t.textLength=r.maxLength;e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.hebrew","class":"error-message"}).text("יש להכניס אותיות בעברית בלבד");i.parent().append(e);n(e)(t);u.errorMessage=u.errorMessage||{};u.errorMessage.hebrew=r.label+": יש להכניס אותיות בעברית בלבד";o=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.longtext","class":"error-message"}).text("יש להכניס עד {{textLength}} תווים");i.parent().append(o);n(o)(t);u.errorMessage=u.errorMessage||{};u.errorMessage.longtext=r.label+": יש להכניס עד {{textLength}} תווים"},post:function(n,t,i,r){t.bind("keyup",function(){});t.on("blur",function(t){var i=this.value,u,f;n.textLength=t.target.attributes.getNamedItem("max-length").nodeValue;i!=""&&i!=null?(u=/^([ א-ת])*$/.test(i),r.$setValidity("hebrew",u),u&&n.textLength&&(f=new RegExp("^[ א-תA-Z]{1,"+n.textLength+"}$"),r.$setValidity("longtext",f.test(i)))):r.$setValidity("hebrew",!0);r.$setViewValue(i);r.$render();n.$apply()})}}}}}]);app.directive("cstEnCharactersText",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){var f,e;setElementNameAndModel(t,u,i);f=i.closest("form")[0].name+"."+i[0].name;t.textLength==null&&(t.textLength=[]);t.textLength=r.maxLength;e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.encharacters","class":"error-message red-text"}).text("Insert only english characters");i.parent().append(e);n(e)(t);u.errorMessage=u.errorMessage||{};u.errorMessage.hebrew=r.label+": Insert only english characters"},post:function(n,t,i,r){t.bind("keyup",function(){});t.on("blur",function(){var t=this.value,i;t!=""&&t!=null?(i=/^([ a-zA-Z])*$/.test(t),r.$setValidity("encharacters",i)):r.$setValidity("encharacters",!0);r.$setViewValue(t);r.$render();n.$apply()})}}}}}]);app.directive("cstSubmit",["utilitiesSvc",function(n){return{restrict:"A",link:function(t,i,r){i.bind("click",function(){var i=$(this).closest("form")[0].name,e,u,f;if(t[i].$invalid){t[i].invalidSubmitAttempt=!0;e=[];for(u in t[i].$error)for(f=0;f<t[i].$error[u].length;f++)e.push(t[i].$error[u][f].errorMessage[u]);return n.showOKMessage(e.join("\n"),"אישור","שגיאה - נא לתקן את השדות הבאים"),t.$apply(),!1}t[i].invalidSubmitAttempt=!1;t.$eval(r.cstSubmit)})}}}]);app.directive("cstRequired",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){setElementNameAndModel(t,u,i);var f=i.closest("form")[0].name+"."+i[0].name,f=i.closest("form")[0].name+"."+i[0].name,e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.required","class":"error-message"}).text("חובה");i.parent().append(e);n(e)(t)},post:function(n,t,i,r){r.errorMessage=r.errorMessage||{};r.errorMessage.required=i.label+": חובה";t.prop("required",!0);r.$parsers.unshift(function(n){var t=n!==""&&n!=undefined;return r.$setValidity("required",t),t?n:undefined});r.$formatters.unshift(function(n){return r.$setValidity("required",n!==""&&n!=undefined),n});i.$observe("disabled",function(n){n!=undefined&&r.$setValidity("required",n)})}}}}}]);app.directive("cstLowerThenDate",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){setElementNameAndModel(t,u,i);var f=i.closest("form")[0].name+"."+i[0].name,f=i.closest("form")[0].name+"."+i[0].name,e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.lowerThenDate","class":"error-message"}).text(r.labelMax);i.parent().append(e);n(e)(t)},post:function(n,t,i,r){r.errorMessage=r.errorMessage||{};r.errorMessage.lowerThenDate=i.label+i.labelMax;var u=function(n){var t=i.dateMaxModel;return!n||!t||n==""?(r.$setValidity("lowerThenDate",!0),n):(angular.isDate(n)||(n=new Date(n)),r.$setValidity("lowerThenDate",n<=new Date(t.replace(/"/g,""))),n)};r.$parsers.unshift(u);r.$formatters.push(u);i.$observe("dateMaxModel",function(){return u(r.$viewValue)})}}}}}]);app.directive("cstBiggerThenDate",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){setElementNameAndModel(t,u,i);var f=i.closest("form")[0].name+"."+i[0].name,f=i.closest("form")[0].name+"."+i[0].name,e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.biggerThenDate","class":"error-message"}).text(r.labelMin);i.parent().append(e);n(e)(t)},post:function(n,t,i,r){r.errorMessage=r.errorMessage||{};r.errorMessage.biggerThenDate=i.label+i.labelMin;var u=function(n){var t=i.dateMinModel;return!n||!t||n==""?(r.$setValidity("biggerThenDate",!0),n):(angular.isDate(n)||(n=new Date(n)),r.$setValidity("biggerThenDate",n>=new Date(t.replace(/"/g,""))),n)};r.$parsers.unshift(u);r.$formatters.push(u);i.$observe("dateMinModel",function(){return u(r.$viewValue)})}}}}}]);app.directive("cstEmail",["$compile",function(n){"use strict";return{restrict:"A",require:"ngModel",compile:function(){return{pre:function(t,i,r,u){setElementNameAndModel(t,u,i);var f=i.closest("form")[0].name+"."+i[0].name,e=angular.element(document.createElement("div")).attr({"ng-show":"("+$("form")[0].name+".invalidSubmitAttempt || "+f+".$dirty ) && "+f+".$error.email","class":"error-message"}).text(r.labelTxt);i.parent().append(e);n(e)(t);u.errorMessage=u.errorMessage||{};u.errorMessage.email=r.label+': כתובת דוא"ל שגויה '},post:function(n,t,i,r){t.on("blur",function(){var t=this.value,i;t!=""?(i=/^([\w\.\-]+)@([\w\-]+)((\.(\w){2,3})+)$/.test(t),r.$setValidity("email",i)):r.$setValidity("email",!0);r.$setViewValue(t);r.$render();n.$apply()})}}}}}]);app.directive("uiBlur",function(){return function(n,t,i){t.bind("blur",function(){n.$apply(i.uiBlur)})}});app.directive("cstPadZero",function(){return{restrict:"A",replace:!0,link:function(n,t,r){t.bind("blur",function(){var u=r.cstPadZero,n;if(t.context.value!=""&&!(t.context.value.length>=u)){for(n="",i=t.context.value.length;i<u;i++)n+="0";t.context.value=n+t.context.value}})}}});app.directive("phoneValidation",["$timeout","$compile","$filter",function(){return{require:"ngModel",scope:{},link:function(n,t,i,r){r.$parsers.push(function(n){if(n=="")return"";var t=n;return t=t.replace(/[^0-9]/g,"").substring(0,7),t!=n&&(r.$setViewValue(t),r.$render()),t.replace(/,/g,"")});r.$formatters.push(function(n){return n})}}}]);app.directive("maxLength",["$compile",function(){return{require:"ngModel",scope:{maxCharters:"=?"},link:function(n,t,i,r){r.$parsers.push(function(t){if(t=="")return"";var i=t;return i=i.substring(0,n.maxCharters),i!=t&&(r.$setViewValue(i),r.$render()),i});r.$formatters.push(function(n){return n})}}}]);app.directive("focus",["$timeout",function(n){return function(t,i,r){n(function(){r.focusme&&i[0].focus()},500)}}]);app.directive("sortableHeader",["$timeout",function(n){return{restrict:"A",scope:{model:"=",sort:"&",readOnly:"="},link:function(t,i){n(function(){var n=i.find(".sortable");n.on("click",function(){if(!t.readOnly){var r=$(this).hasClass("asc"),i=$(this).hasClass("desc");n.removeClass("asc").removeClass("desc");t.model.field=$(this).attr("field");!i&&(r||i)?($(this).addClass("desc"),t.model.direction="desc"):($(this).addClass("asc"),t.model.direction="asc");t.sort()}})},0)}}}]);app.factory("serviceHelperSvc",["$http","$resource",function(n,t){var u="",i=function(n){return u+n},r=t(i("api/Invoker")),f=t(i("api/Invoker"),{},{get:{method:"GET",cache:!0}});return r.createMethodName=function(n){return n+"?key="+sessionStorage.getItem("sessionid")},r.convertJsonToUri=function(n){var t="&";for(p in n)t+=p+"="+n[p]+"&";return t},{Invoker:r,InvokerWithCache:f,Users:t(i("api/User")),logoff:t(i("api/User/Logoff")),updateUserPassword:t(i("api/User"),null,{updatePassword:{method:"put"}}),SendConfirmCode:t(i("api/User/SendConfirmCode")),VerifyConfirmCode:t(i("api/User/VerifyConfirmCode")),VerifyUsername:t(i("api/User/VerifyUsername")),CreateUser:t(i("api/User/Create")),updateUserDetails:t(i("api/User/Update")),Portfolios:t(i("api/Portfolios")),updatePortfolios:t(i("api/Portfolios"),null,{updatePort:{method:"put"}}),PortfoliosId:t(i("api/Portfolios/:id"),{id:"@id"}),Securities:t(i("api/Securities"),null,{getAll:{method:"get",url:i("api/Securities/GetAll")}}),Optimization:t(i("api/Optimization")),GetBenchmarkSecurities:t(i("api/Securities/GetBenchmarkSecurities")),Backtesting:t(i("api/Backtesting")),BacktestingId:t(i("api/Backtesting/:id"),{id:"@id"}),BacktestingPortfolios:t(i("api/BacktestingPortfolios")),BacktestingPortfoliosId:t(i("api/BacktestingPortfolios/:portId"),{portId:"@portId"}),Prices:t(i("api/Prices")),License:t(i("api/License")),CalculateLicense:t(i("api/License/Calculate")),Lookups:t(i("api/Lookup")),Session:{removeSession:function(){var n=new XMLHttpRequest;return n.open("post",i("api/Users/RemoveSession?key="+sessionStorage.getItem("sessionid")),!1),n.send(),!0}},exportToExcel:function(t,u){return n({url:i("api/Invoker"),method:"GET",params:{method:t+"?key="+sessionStorage.getItem("sessionid"),param:r.convertJsonToUri(u)}})},UserGroup:t(i("api/users/GetUserGroup"))}}]);app.factory("loginSvc",["$window","$http","$q","serviceHelperSvc",function(n,t,i,r){var f=r.Users,e=r.logoff,o=r.updateUserPassword,u,s=function(n){u=n;t.defaults.headers.common.Authorization="Basic "+n};return n.onbeforeunload=function(){u&&sessionStorage.setItem("sessionid",angular.toJson(u))},{get:function(n){var t=i.defer();return f.save(n,function(n,i){n.User!=null&&s(i("sessionid"));t.resolve(n)},function(n){t.reject(n)}),t.promise},logoff:function(){return e.get()},updatePasswrod:function(n){return o.updatePassword(n)}}}]);app.factory("utilitiesSvc",["prompt","$q",function(n,t){return{showOKMessage:function(t,i,r,u,f){if(sessionStorage.getItem("user")||f){r==""&&(r="Ok");return n({title:t,message:i,heformat:u,buttons:[{label:r,cancel:!1,primary:!0,isfocus:!0}]})}},showOKMessageWithIndication:function(i,r,u,f){u||(u="Ok");var e=t.defer();return n({title:i,message:r,heformat:f,buttons:[{label:u,cancel:!1,primary:!0,isfocus:!0}]}).then(function(){e.resolve()}),e.promise},showYesNoMessage:function(i,r,u,f){var e=t.defer();return n({title:i,message:r,buttons:[{label:u,cancel:!1,primary:!0,"class":"btn-green"},{label:f,cancel:!0,primary:!1,"class":"bold",isfocus:!0}]}).then(function(){e.resolve()},function(){e.reject()}),e.promise},exportToPdf:function(n,i){var r=t.defer(),f=function(n){var t=new Image,i=n.toDataURL("image/png");return t.src=i,t},e=function(n,t){var r,u,i;return(t=parseInt(t)||0,!t)?n:(r=document.createElement("canvas"),r.height=n.height-t,r.width=n.width,u=r.getContext("2d"),i=f(n),u.drawImage(i,0,t,i.width,i.height,0,0,i.width,i.height),r)},o=function(n){for(var t=new jsPDF("l","px"),f=t.internal,o=f.pageSize,s=f.scaleFactor,h=o.width,v=o.height,u=0,c=n.height,y=n.width/(h*s),l=0,a;u<c&&l<15;)a=e(n,u),t.addImage(a,"png",0,0,h,0,null,"NONE"),u+=v*s*y,u<c&&t.addPage(),l++;t.save(i+".pdf");r.resolve()},u;return $("body").css("overflow","auto"),u=$(".height-page-body").css("max-height"),$(".height-page-body").css("max-height","none"),html2canvas($("#"+n)[0],{onrendered:function(n){o(n);$(".height-page-body").css("max-height",u)}}),r.promise}}}]);app.factory("portfolioSvc",["$window","$resource","$q","serviceHelperSvc",function(n,t,i,r){var u=r.Portfolios,f=r.updatePortfolios,e=r.PortfoliosId;return{getPortfolios:function(n){return u.get({pageSize:n.pageSize,pageNumber:n.pageNumber,sortField:n.sortField})},createPortfolio:function(n){return u.save(n)},updatePortfolio:function(n){return f.updatePort(n)},getSinglePortfolio:function(n){return e.get({id:n})},deletePortfolio:function(n){return u.delete({portId:n})},exportOptimize:function(n){return r.Optimization.save(n)}}}]);app.factory("errorHandler",["prompt",function(n){return{checkErrors:function(t){var i=[],r,u,f;if(t.Messages!=null&&t.Messages.length>0)i=Enumerable.From(t.Messages).Where(function(n){return n.LogLevel==Log.Level.Fatal||n.LogLevel==Log.Level.Error}).Select(function(n){return n.Text}).ToArray();else if(t.ModelState!=null)for(r in t.ModelState)if(r!="$id")for(u=0;u<t.ModelState[r].length;u++)i.push(t.ModelState[r][u]);return i.length>0?(f=i.join("<br>"),n({title:"Error",message:f,buttons:[{label:"OK",cancel:!1,primary:!0}]}),!0):!1}}}]);app.factory("securitiesSvc",["serviceHelperSvc",function(n){var t=n.Securities,i=n.GetBenchmarkSecurities;return{getSecurities:function(){return t.get()},getBenchmarkSecurities:function(){return i.get()},getAllSecurities:function(n){return t.getAll(n)}}}]);app.factory("lookupSvc",["$window","$http","$q","serviceHelperSvc",function(n,t,i,r){var u=r.Lookups;return{getLookup:function(){return u.get()}}}]);app.factory("generalSvc",["serviceHelperSvc",function(n){var t=n.InvokerWithCache,i=n.Invoker;return{getGeneralObject:function(){return t.get({method:i.createMethodName("offices")})}}}]);app.filter("percentage",["$filter",function(n){return function(t,i){return n("number")(t*100,i)+"%"}}]);app.filter("DistirictCountry",function(){return function(n,t,i){var f=[],r,u;if(n!=undefined)for(r=0;r<n.length;r++)u=n[r][i],(u==t||u==-1)&&f.push(n[r]);return f}});app.factory("priceSvc",["serviceHelperSvc",function(n){var t=n.Prices;return{getPrices:function(n){return t.get(n)}}}]);app.factory("backtestingSvc",["serviceHelperSvc",function(n){var i=n.Backtesting,t=n.BacktestingPortfolios,r=n.BacktestingId,u=n.PortfoliosId;return{createBacktesting:function(n){return i.save(n)},getbacktesingPortfolies:function(n){return t.get({pageSize:n.pageSize,pageNumber:n.pageNumber,sortField:n.sortField})},getbacktesingPortfoliesById:function(n){return r.get({id:n})},deleteBacktesting:function(n){return t.delete({portId:n})}}}]);app.factory("exportDataSvc",function(){var n=function(n,t,i){for(var a,k,o,s,h,v,r,c,y="application/octet-stream",u=!1,f=i,l=y,p=window.atob(n),w=p.length,b=new Uint8Array(w),e=0;e<w;e++)b[e]=p.charCodeAt(e);n=b;try{if(r=new Blob([n],{type:l}),navigator.msSaveBlob)navigator.msSaveBlob(r,f);else{if(a=navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob,a===undefined)throw"Not supported";a(r,f)}u=!0}catch(d){}if(!u){if(k=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,k){o=new FileReader;o.onload=function(){var n=btoa(o.result),t="data:text/csv;charset=utf-8;;base64,"+n;newWindow=window.open(t);newWindow.document.title=f};r=new Blob([n],{type:l});o.readAsBinaryString(r);return}if(s=window.URL||window.webkitURL||window.mozURL||window.msURL,s){h=document.createElement("a");try{r=new Blob([n],{type:l});c=s.createObjectURL(r);h.setAttribute("href",c);h.setAttribute("download",f);v=document.createEvent("MouseEvents");v.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null);h.dispatchEvent(v);u=!0}catch(d){}if(!u)try{r=new Blob([n],{type:y});c=s.createObjectURL(r);window.location=c;u=!0}catch(d){}}}u||alert("היצוא נכשל")};return{download:n}}),function(n){n.module("takinApp").constant("tfiCommonConstants",{updateAccountData:"updateAccountData",isInProgress:"isInProgress",wantToLogout:"wantToLogout",menuItemChanged:"menuItemChanged",objNameChanged:"objNameChanged",isDataReady:"isDataReady"})}(angular);app.factory("userSvc",["$window","$http","$q","serviceHelperSvc",function(n,t,i,r){return{sendUserConfirmCode:function(n){return r.SendConfirmCode.save(n)},verifyConfirmCode:function(n){return r.VerifyConfirmCode.save(n)},verifyUsername:function(n){return r.VerifyUsername.save(n)},createUser:function(n){return r.CreateUser.save(n)},updateUesrDetails:function(n){return r.updateUserDetails.save(n)}}}]);app.factory("licenseSvc",["serviceHelperSvc",function(n){var t=n.CalculateLicense;return{calculateLicense:function(n){return t.get(n)},updateUserLicence:function(t){return n.License.save(t)}}}]);var buttonsType={OK:"OK"},messagesType={error:"Error",message:"Message"},riskColors={TP:"#d7dbdc",Solid:"#2fd074",Low:"#f9ec23",Moderate:"#f9b50a",High:"#ff8812","Very High":"#fc3d5e",none:"#ffffff"},Log={};Log.Level={Fatal:0,Error:1,Warning:2,Info:3};var enumEfCalculationType={BestTP:1,BestRisk:2,SecurityStd:3,Custom:4},Licensetype={FullLicense:1,FollowupLicense:2,Trial:3},messages={successLoginMsg:"כניסתך לאתר אומתה בהצלחה",failedLoginMsg:"כניסתך לאתר נכשלה "};app.factory("errorHandler",["prompt",function(n){return{checkErrors:function(t){var i=[],r,u,f;if(t.Messages!=null&&t.Messages.length>0)i=Enumerable.From(t.Messages).Where(function(n){return n.LogLevel==Log.Level.Fatal||n.LogLevel==Log.Level.Error}).Select(function(n){return n.Text}).ToArray();else if(t.ModelState!=null)for(r in t.ModelState)if(r!="$id")for(u=0;u<t.ModelState[r].length;u++)i.push(t.ModelState[r][u]);return i.length>0?(f=i.join("<br>"),n({title:"Error",message:f,buttons:[{label:"OK",cancel:!1,primary:!0}]}),!0):!1}}}]),function(n){n.extend(n.datepicker,{_inlineDatepicker2:n.datepicker._inlineDatepicker,_inlineDatepicker:function(t,i){this._inlineDatepicker2(t,i);var r=n.datepicker._get(i,"beforeShow");r&&r.apply(t,[t,i])}});n.datepicker._gotoToday=function(t){var r=n(t),u=new Date,f,i;r.attr("allowd-days")!=null&&(f=r.attr("allowd-days").split(","),f.indexOf(u.getDay().toString()==-1))||(i=this._getInst(r[0]),this._get(i,"gotoCurrent")&&i.currentDay?(i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear):(i.selectedDay=u.getDate(),i.drawMonth=i.selectedMonth=u.getMonth(),i.drawYear=i.selectedYear=u.getFullYear(),this._setDateDatepicker(r,u),this._selectDate(t,this._getDateDatepicker(r))),this._notifyChange(i),this._adjustDate(r))}}(jQuery);utilities.directive("cstDatepicker",["$timeout",function(n){function t(t,i,r,u){var f=r.formatDate?r.formatDate:"dd/mm/yy",e=r.allowdDays?r.allowdDays.split(","):[0,1,2,3,4,5,6];n(function(){var n=new Date,r;n.setMonth(n.getMonth()-18);r=i.datepicker({showOn:"button",buttonImage:"Content/themes/images/Calandar.png",buttonImageOnly:!0,buttonText:"Select date",changeMonth:!0,changeYear:!0,showButtonPanel:!0,dateFormat:f,minDate:n,maxDate:new Date,onSelect:function(){var n=$(this).datepicker("getDate"),i=n.getHours();n.setHours(i+3);u.$setViewValue(n);t.$apply();u.$setValidity("invalid",!0)},onClose:function(){u.$setValidity("invalid",!0)},onChangeMonthYear:function(){setTimeout(function(){$($(".ui-datepicker-calendar").find("a")[0]).addClass("ui-state-active")},100)},beforeShow:function(){setTimeout(function(){$(".modal").css("display")=="block"&&($(".modal").css("display",""),setTimeout(function(){$(".modal").css("display","block")},50))},1)},beforeShowDay:function(n){var t=n.getDay();return[e.indexOf(t.toString())>-1,""]}});u.$render()});r.yearRange&&$(i).datepicker("option","yearRange",r.yearRange);r.monthRange&&$(i).datepicker("option","monthRange",r.monthRange);r.$observe("disabled",function(n){n!=undefined&&$(i).datepicker("option","disabled",n)});u.$render=function(){var n=u.$viewValue;if(n==""?n=null:typeof n=="string"&&(n=new Date(n),n.getFullYear()==1&&(n=null)),angular.isDefined(n)&&n!==null&&!angular.isDate(n))throw new Error("ng-Model value must be a Date object - currently it is a "+typeof n+" - use ui-date-format to convert it from a string");i.datepicker("setDate",n)};i.on("blur",function(){var n,i;if(!$(this).datepicker("widget").is(":visible")){if(this.value=="")return;if(i=this.value.split("/"),f=="mm/yy")n=new Date(i[1],i[0]-1,1);else if(f=="yy/mm")n=new Date(i[0],i[1]-1,1);else try{n=$.datepicker.parseDate(f,this.value)}catch(e){n=""}angular.isDate(n)&&n.toString()!="Invalid Date"?(n.setHours(2),u.$setViewValue(n)):u.$setViewValue("");u.$render();t.$apply()}})}return{restrict:"A",require:"ngModel",replace:!0,compile:function(n){return n.addClass("cst-datepicker"),t}}}]);